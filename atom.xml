<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>fantasy&#39;s blog</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://majiaji.github.io/"/>
  <updated>2016-12-25T15:59:58.000Z</updated>
  <id>https://majiaji.github.io/</id>
  
  <author>
    <name>fantasy</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ç†è§£å›è°ƒæœºåˆ¶</title>
    <link href="https://majiaji.github.io/2016/12/25/%E7%90%86%E8%A7%A3%E5%9B%9E%E8%B0%83/"/>
    <id>https://majiaji.github.io/2016/12/25/ç†è§£å›è°ƒ/</id>
    <published>2016-12-25T11:27:57.000Z</published>
    <updated>2016-12-25T15:59:58.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å¯¹å›è°ƒçš„ç†è§£"><a href="#å¯¹å›è°ƒçš„ç†è§£" class="headerlink" title="å¯¹å›è°ƒçš„ç†è§£"></a>å¯¹å›è°ƒçš„ç†è§£</h3><p>ä¹‹å‰å›è°ƒç”¨çš„æ¯”è¾ƒå°‘ï¼Œä¸€ç›´ç†è§£ä¸ºè§‚å¯Ÿè€…æ¨¡å¼ã€‚æœ€è¿‘æ€è€ƒäº†ä¸€æ³¢ï¼Œå›è°ƒå¹¶ä¸èƒ½å’ŒæŸç§è®¾è®¡æ¨¡å¼ç»‘å®šåœ¨ä¸€èµ·ï¼Œå®ƒå…¶å®åªæ˜¯ä¸€ç§é€šç”¨çš„å†™æ³•ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼šæœ‰ä¸¤ä¸ªç±»Aå’ŒBï¼ŒBæ˜¯Açš„å±æ€§ï¼ŒAå¯ä»¥é€šè¿‡å‡½æ•°è°ƒç”¨Bçš„æ–¹æ³•ï¼ŒåŒæ—¶æŠŠè‡ªå·±ä½œä¸ºå‚æ•°ä¼ é€’åˆ°Bçš„æ–¹æ³•ä¸­ï¼ŒBçš„æ–¹æ³•åœ¨å®Œæˆæ—¶å¯ä»¥è°ƒç”¨Açš„å‡½æ•°ï¼Œè¿™å°±æ˜¯å›è°ƒã€‚å¦‚æœAåœ¨è°ƒç”¨Bçš„æ–¹æ³•æ—¶åŒæ­¥ç­‰å¾…ï¼Œåˆ™æ˜¯åŒæ­¥å›è°ƒï¼›å¦åˆ™å³ä¸ºå¼‚æ­¥å›è°ƒã€‚Açš„å¼•ç”¨å¯ä»¥ä½œä¸ºæ–¹æ³•å‚æ•°å¸¦å…¥Bä¸­ï¼Œä¹Ÿå¯ä»¥æ”¾åˆ°ThreadLocalä¸­è¿›è¡Œä¼ é€’ã€‚ä¸‹è¾¹æ˜¯å…·ä½“ä¾‹å­çš„ä»£ç ï¼š</p>
<a id="more"></a>
<h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><p>é¦–å…ˆå®šä¹‰ä¸€ä¸ªæ¥å£ICallBackï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ICallBack</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div></pre></td></tr></table></figure></p>
<p>Aç±»è¦å®ç°è¿™ä¸ªæ¥å£ï¼ŒåŒæ—¶Aä¸­æœ‰Bçš„å¼•ç”¨ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">implements</span> <span class="title">ICallBack</span> </span>&#123;</div><div class="line">    B b = <span class="keyword">new</span> B();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">doBizSync</span><span class="params">()</span> </span>&#123;</div><div class="line">        b.remoteCall(<span class="keyword">this</span>);</div><div class="line">        System.out.println(<span class="string">"doBizSync return"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">doBizAsync</span><span class="params">()</span> </span>&#123;</div><div class="line">        A temp = <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</div><div class="line">            b.remoteCall(temp);</div><div class="line">        &#125;).start();</div><div class="line">        System.out.println(<span class="string">"doBizAsync return"</span>);</div><div class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                <span class="keyword">this</span>.wait();</div><div class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"call back completed"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Aæœ‰ä¸¤ä¸ªä¸šåŠ¡å‡½æ•°ï¼Œåˆ†åˆ«ç”¨æ¥æµ‹è¯•åŒæ­¥å’Œå¼‚æ­¥å›è°ƒã€‚</p>
<p>ä¸‹è¾¹æ˜¯ç±»Bçš„å®šä¹‰ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</div><div class="line">    <span class="function">String <span class="title">remoteCall</span><span class="params">(A a)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"this will cost 5 secodes..."</span>);</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            Thread.sleep(<span class="number">5000L</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        a.onComplete();</div><div class="line">        <span class="keyword">synchronized</span> (a) &#123;</div><div class="line">            a.notify();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="string">"remoteCall complete"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><br>ç±»Bä¸­ç”¨remoteCallå‡½æ•°æ¥æ¨¡æ‹Ÿè¿œç¨‹è°ƒç”¨çš„åœºæ™¯ã€‚åœ¨çœŸå®åœºæ™¯ä¸­ï¼ŒBä¸ºä¸€ä¸ªæ³¨å…¥åˆ°Açš„service beanã€‚</p>
<p>æµ‹è¯•ç±»å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSync</span><span class="params">()</span> </span>&#123;</div><div class="line">        A a = <span class="keyword">new</span> A();</div><div class="line">        a.doBizSync();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//ç»“æœï¼š</span></div><div class="line">    <span class="comment">//this will cost 5 secodes...</span></div><div class="line">    <span class="comment">//call back completed</span></div><div class="line">    <span class="comment">//doBizSync return</span></div><div class="line"></div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAsync</span><span class="params">()</span> </span>&#123;</div><div class="line">        A a = <span class="keyword">new</span> A();</div><div class="line">        a.doBizAsync();</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//ç»“æœï¼š</span></div><div class="line">    <span class="comment">//doBizAsync return</span></div><div class="line">    <span class="comment">//this will cost 5 secodes...</span></div><div class="line">    <span class="comment">//call back completed</span></div><div class="line"></div></pre></td></tr></table></figure><br>å¯è§å¼‚æ­¥å›è°ƒä¸­å½“å‰çº¿ç¨‹ä¸ç”¨ä¸€ç›´ç­‰å¾…è¿œç¨‹æ–¹æ³•è¿”å›ï¼Œå¯ä»¥å»å¤„ç†å…¶ä»–ä¸šåŠ¡äº†ã€‚è¿™ç§å†™æ³•å¯ä»¥èŠ‚çœçº¿ç¨‹æ± èµ„æºï¼Œæé«˜å¹¶å‘ã€‚å½“å›è°ƒå¤„ç†å‡½æ•°åªæœ‰ä¸€ä¸ªæ—¶ï¼ŒICallBackä¹Ÿå¯ä»¥çœå»äº†ï¼Œå¯ä»¥ç”¨lambdaè¡¨è¾¾å¼æ¥ä»£æ›¿ã€‚</p>
<h3 id="Servlet-3-0å¼€å¯å¼‚æ­¥"><a href="#Servlet-3-0å¼€å¯å¼‚æ­¥" class="headerlink" title="Servlet 3.0å¼€å¯å¼‚æ­¥"></a>Servlet 3.0å¼€å¯å¼‚æ­¥</h3><p>Servlet 3.0æ”¯æŒå¼€å¯å¼‚æ­¥ï¼Œè¿™æ ·å¯ä»¥å®ç°å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„è¿æ¥è¿˜åœ¨ï¼ŒServletä¸­çš„çº¿ç¨‹å°±ä¸ç”¨é˜»å¡çš„ç­‰å¾…åœ¨è¿™é‡Œäº†ï¼Œå¯ä»¥é‡Šæ”¾å‡ºæ¥å»åšåˆ«çš„äº‹æƒ…ã€‚ä»£ç ä¾‹å­å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Controller</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServletAsyncTestController</span> </span>&#123;</div><div class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/test"</span>, method = &#123;RequestMethod.GET, RequestMethod.POST&#125;)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">asyncAjax</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        <span class="keyword">final</span> PrintWriter writer = response.getWriter();</div><div class="line">        writer.println(<span class="string">"first message....\r\n"</span>);</div><div class="line">        request.setAttribute(<span class="string">"org.apache.catalina.ASYNC_SUPPORTED"</span>, <span class="keyword">true</span>);</div><div class="line">        <span class="keyword">final</span> AsyncContext asyncContext = request.startAsync(request, response);</div><div class="line">        asyncContext.setTimeout(<span class="number">100000</span>); <span class="comment">//æµ‹è¯•è®¾ç½®è¶…æ—¶æ—¶é—´</span></div><div class="line">        asyncContext.start(() -&gt; &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    Thread.sleep(<span class="number">1000</span>);</div><div class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line"></div><div class="line">                &#125;</div><div class="line">                writer.println(<span class="string">"hi.....\r\n"</span>);</div><div class="line">            &#125;</div><div class="line">            asyncContext.complete();</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><br>ä¸šåŠ¡çº¿ç¨‹åšå®Œè€—æ—¶ä¸šåŠ¡åï¼Œè°ƒç”¨asyncContext.complete()ï¼Œå®¢æˆ·ç«¯å°±èƒ½æ”¶åˆ°è¿”å›äº†ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;å¯¹å›è°ƒçš„ç†è§£&quot;&gt;&lt;a href=&quot;#å¯¹å›è°ƒçš„ç†è§£&quot; class=&quot;headerlink&quot; title=&quot;å¯¹å›è°ƒçš„ç†è§£&quot;&gt;&lt;/a&gt;å¯¹å›è°ƒçš„ç†è§£&lt;/h3&gt;&lt;p&gt;ä¹‹å‰å›è°ƒç”¨çš„æ¯”è¾ƒå°‘ï¼Œä¸€ç›´ç†è§£ä¸ºè§‚å¯Ÿè€…æ¨¡å¼ã€‚æœ€è¿‘æ€è€ƒäº†ä¸€æ³¢ï¼Œå›è°ƒå¹¶ä¸èƒ½å’ŒæŸç§è®¾è®¡æ¨¡å¼ç»‘å®šåœ¨ä¸€èµ·ï¼Œå®ƒå…¶å®åªæ˜¯ä¸€ç§é€šç”¨çš„å†™æ³•ã€‚&lt;/p&gt;
&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼šæœ‰ä¸¤ä¸ªç±»Aå’ŒBï¼ŒBæ˜¯Açš„å±æ€§ï¼ŒAå¯ä»¥é€šè¿‡å‡½æ•°è°ƒç”¨Bçš„æ–¹æ³•ï¼ŒåŒæ—¶æŠŠè‡ªå·±ä½œä¸ºå‚æ•°ä¼ é€’åˆ°Bçš„æ–¹æ³•ä¸­ï¼ŒBçš„æ–¹æ³•åœ¨å®Œæˆæ—¶å¯ä»¥è°ƒç”¨Açš„å‡½æ•°ï¼Œè¿™å°±æ˜¯å›è°ƒã€‚å¦‚æœAåœ¨è°ƒç”¨Bçš„æ–¹æ³•æ—¶åŒæ­¥ç­‰å¾…ï¼Œåˆ™æ˜¯åŒæ­¥å›è°ƒï¼›å¦åˆ™å³ä¸ºå¼‚æ­¥å›è°ƒã€‚Açš„å¼•ç”¨å¯ä»¥ä½œä¸ºæ–¹æ³•å‚æ•°å¸¦å…¥Bä¸­ï¼Œä¹Ÿå¯ä»¥æ”¾åˆ°ThreadLocalä¸­è¿›è¡Œä¼ é€’ã€‚ä¸‹è¾¹æ˜¯å…·ä½“ä¾‹å­çš„ä»£ç ï¼š&lt;/p&gt;
    
    </summary>
    
      <category term="åå°" scheme="https://majiaji.github.io/categories/%E5%90%8E%E5%8F%B0/"/>
    
    
      <category term="åå°" scheme="https://majiaji.github.io/tags/%E5%90%8E%E5%8F%B0/"/>
    
  </entry>
  
  <entry>
    <title>é•¿è¿æ¥é€šé“è§£å†³æ–¹æ¡ˆ</title>
    <link href="https://majiaji.github.io/2016/12/24/%E9%95%BF%E8%BF%9E%E6%8E%A5%E9%80%9A%E9%81%93%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <id>https://majiaji.github.io/2016/12/24/é•¿è¿æ¥é€šé“è§£å†³æ–¹æ¡ˆ/</id>
    <published>2016-12-24T06:27:07.000Z</published>
    <updated>2016-12-25T06:31:47.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸ºä»€ä¹ˆè¦é•¿è¿æ¥"><a href="#ä¸ºä»€ä¹ˆè¦é•¿è¿æ¥" class="headerlink" title="ä¸ºä»€ä¹ˆè¦é•¿è¿æ¥"></a>ä¸ºä»€ä¹ˆè¦é•¿è¿æ¥</h2><h3 id="èµ„æºä¸­å¿ƒoræ§åˆ¶ä¸­å¿ƒ"><a href="#èµ„æºä¸­å¿ƒoræ§åˆ¶ä¸­å¿ƒ" class="headerlink" title="èµ„æºä¸­å¿ƒoræ§åˆ¶ä¸­å¿ƒ"></a>èµ„æºä¸­å¿ƒoræ§åˆ¶ä¸­å¿ƒ</h3><p>å¾ˆä¹…ä»¥æ¥ï¼ŒæœåŠ¡ç«¯ä¸€ç›´ä½œä¸ºâ€œç»Ÿä¸€èµ„æºä¸­å¿ƒâ€è€Œå­˜åœ¨ï¼Œæ‰€ä»¥åå°å¼€å‘å·¥ç¨‹å¸ˆä»¬çš„åŸºç¡€å·¥ä½œå°±æ˜¯å­˜å‚¨ã€ç»´æŠ¤å’Œç®¡ç†ç”¨æˆ·çš„æ•°æ®ï¼Œç„¶åå¼€æ¥å£ç»™å®¢æˆ·ç«¯&amp;&amp;å‰ç«¯åŒå­¦ä½¿ç”¨ã€‚åæ¥å‡ºç°äº†restfulæ¶æ„é£æ ¼ï¼šä¸€ä¸ªURIä»£è¡¨ä¸€ä¸ªèµ„æºï¼Œå®¢æˆ·ç«¯ç”¨HTTPåè®®çš„æ“ä½œæ–¹å¼ï¼ˆGETã€POSTã€PUTã€DELETEï¼‰å¯¹èµ„æºè¿›è¡Œæ“ä½œï¼Œå³å®Œæˆäº†ä¸æœåŠ¡ç«¯çš„äº¤äº’ã€‚è¿™æ ·çš„è®¾è®¡å¯ä»¥è®©æœåŠ¡ç«¯çš„é€»è¾‘å˜å¾—éå¸¸çš„è½»ï¼ŒçœŸçš„å˜æˆäº†â€œèµ„æºä¸­å¿ƒâ€äº†ã€‚å®¢æˆ·ç«¯å¯ä»¥ä¾æ‰˜æ“ä½œèµ„æºçš„æ¥å£å»å®ç°çœŸæ­£çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ¸²æŸ“ç•Œé¢ã€‚è€ƒè™‘åˆ°ä¸€äº›å¼‚å¸¸æƒ…å†µå¤„ç†ï¼Œé€»è¾‘ä¼šåšçš„æ¯”è¾ƒé‡ã€‚</p>
<p>å¯¹äºåå°å¼€å‘åŒå­¦æ¥è¯´ï¼Œä¸€å®šä¸ä¼šæ»¡è¶³äºâ€œèµ„æºç®¡ç†è€…â€è¿™æ ·çš„è§’è‰²ï¼Œæ¯å¤©å†™å†™å¢åˆ æ”¹æŸ¥å’Œå­—ç¬¦ä¸²æ‹¼æ¥ã€‚å› ä¸ºæœ‰é•¿è¿æ¥æŠ€æœ¯çš„å­˜åœ¨ï¼ŒæœåŠ¡ç«¯å¯ä»¥åšæ›´å¤šçš„äº‹æƒ…ã€‚ç›¸å¯¹äºå®¢æˆ·ç«¯æŠŠæœåŠ¡ç«¯å½“æˆâ€œæ•°æ®èµ„æºåº“â€ï¼Œåè¿‡æ¥ï¼ŒæœåŠ¡ç«¯ä¹Ÿå¯ä»¥æŠŠå®¢æˆ·ç«¯çœ‹æˆâ€œUIåº“â€ï¼Œé€šè¿‡é•¿è¿æ¥é€šé“æ¨é€å‘½ä»¤ä¸‹å»ï¼ŒæŒ‡å¯¼å®¢æˆ·ç«¯UIè¿›è¡Œå˜åŒ–ã€‚è¿™æ ·æœåŠ¡ç«¯å°±ä»â€œèµ„æºä¸­å¿ƒâ€å˜æˆäº†â€œæ§åˆ¶ä¸­å¿ƒâ€ã€‚å½“ç„¶è¿™æ˜¯ä¸€ç§æ¯”è¾ƒæç«¯çš„è®¾è®¡ï¼Œé•¿è¿æ¥å¯èƒ½å› ä¸ºç½‘ç»œæˆ–è€…å®¢æˆ·ç«¯ç¯å¢ƒé—®é¢˜æ–­æ‰ï¼Œè¿™æ ·æ§åˆ¶ä¸­å¿ƒå°±å¤±å»æ§åˆ¶èƒ½åŠ›äº†ã€‚æ‰€ä»¥åœ¨å®ç°ä¸šåŠ¡æ—¶å¯ä»¥ç”¨æ¨æ‹‰ç»“åˆçš„æ¨¡å¼ã€‚</p>
<h3 id="å³æ—¶è§¦è¾¾çš„èƒ½åŠ›"><a href="#å³æ—¶è§¦è¾¾çš„èƒ½åŠ›" class="headerlink" title="å³æ—¶è§¦è¾¾çš„èƒ½åŠ›"></a>å³æ—¶è§¦è¾¾çš„èƒ½åŠ›</h3><p>å› ä¸ºæœ‰äº†é•¿è¿æ¥é€šé“ï¼ŒæœåŠ¡ç«¯æœ‰äº†æ¶ˆæ¯å³æ—¶è§¦è¾¾çš„èƒ½åŠ›ï¼ŒåŒæ—¶é¿å…äº†å®¢æˆ·ç«¯åˆ†å¸ƒå¼æ”»å‡»å¼çš„è½®è¯¢ã€‚è¿™ä¸ªèƒ½åŠ›æ˜¯éå¸¸éå¸¸é‡è¦çš„ï¼Œåœ¨è®¾è®¡åœ¨çº¿ç½‘ç»œæ¸¸æˆã€IMç³»ç»Ÿã€æ¨é€ç³»ç»Ÿæ—¶é•¿è¿æ¥é€šé“ä¸å¯æˆ–ç¼ºã€‚</p>
<h3 id="ä¸šç•Œé€šç”¨æ¨é€æ–¹æ³•"><a href="#ä¸šç•Œé€šç”¨æ¨é€æ–¹æ³•" class="headerlink" title="ä¸šç•Œé€šç”¨æ¨é€æ–¹æ³•"></a>ä¸šç•Œé€šç”¨æ¨é€æ–¹æ³•</h3><p>ç°åœ¨ç§»åŠ¨ç«¯éƒ½æœ‰è‡ªå·±çš„pushç³»ç»Ÿï¼ŒiOSæœ‰<a href="https://developer.apple.com/notifications/" target="_blank" rel="external">APNS(Apple Push Notification service)</a>,Androidæœ‰<a href="https://developers.google.com/cloud-messaging/?hl=zh-cn/" target="_blank" rel="external">GCM(Google Cloud Messaging)</a>ã€‚å¯ä»¥ç®€å•ç†è§£ä¸ºå®˜æ–¹çš„ä¸€ä¸ªæœåŠ¡å’Œç§»åŠ¨å®¢æˆ·ç«¯å»ºç«‹äº†ä¸€ä¸ªé•¿è¿æ¥ï¼Œæ‰€æœ‰çš„appå…±ç”¨è¿™æ¡é€šé“ï¼Œæ¯æ¬¡æ¨é€æ—¶è¦ç”¨è‡ªå·±çš„æœåŠ¡è°ƒç”¨ä¸€ä¸‹å®˜æ–¹æœåŠ¡çš„æ¥å£ï¼Œç„¶åç”±å®˜æ–¹çš„æœåŠ¡è¿›è¡Œæ¨é€ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°æ¨é€åä¼šåœ¨ç³»ç»Ÿé€šçŸ¥æ çœ‹åˆ°appæ¨é€çš„ä¸€ä¸ªæ¦‚è¦ä¿¡æ¯ï¼Œç”¨æˆ·ç‚¹å‡»è¿™æ¡push,ä¼šå”¤èµ·å¯¹åº”çš„appï¼Œè¿›å…¥appåä¼šè°ƒç”¨appè‡ªå·±çš„æœåŠ¡æ¥å£æ‹‰å–æ›´å¤šçš„ä¸šåŠ¡æ•°æ®ã€‚</p>
<p>å› ä¸ºå“ˆå“ˆå“ˆå“ˆçš„åŸå› ï¼ŒGCMåœ¨å›½å†…å‡ ä¹ä¸èƒ½ä½¿ç”¨ï¼›å¦‚æœåº”ç”¨æœ‰pcç«¯è¿˜è¦æ”¯æŒpcç«¯çš„æ¨é€;ä¸šåŠ¡æ¯”è¾ƒå¤æ‚æ—¶ä¼šå¸Œæœ›è®¾è®¡ä¸€ç§æ›´é«˜æ•ˆçµæ´»çš„æ¨é€åè®®ã€‚åŸºäºä»¥ä¸ŠåŸå› ï¼Œå¼€å‘è€…ä¼šè®¾è®¡è‡ªå·±çš„é•¿è¿æ¥é€šé“å’Œæ¨é€åè®®ã€‚</p>
<a id="more"></a>
<h2 id="å®¢æˆ·ç«¯é•¿è¿æ¥æ–¹æ¡ˆ"><a href="#å®¢æˆ·ç«¯é•¿è¿æ¥æ–¹æ¡ˆ" class="headerlink" title="å®¢æˆ·ç«¯é•¿è¿æ¥æ–¹æ¡ˆ"></a>å®¢æˆ·ç«¯é•¿è¿æ¥æ–¹æ¡ˆ</h2><p>ä¸‹è¾¹ç»™å¤§å®¶ä»‹ç»ä¸€æ¬¾è½»é‡çº§çš„é•¿è¿æ¥&amp;&amp;æ¨é€æ¡†æ¶(ä¾èµ–netty4.1.2) <a href="https://github.com/majiaji/rivendell" target="_blank" rel="external">rivendell</a>ï¼Œåå­—å‡ºè‡ªã€Šthe Lord of the Ringsã€‹ã€‚</p>
<h3 id="æ¡†æ¶ç‰¹æ€§"><a href="#æ¡†æ¶ç‰¹æ€§" class="headerlink" title="æ¡†æ¶ç‰¹æ€§"></a>æ¡†æ¶ç‰¹æ€§</h3><ul>
<li>é•¿è¿æ¥ç®¡ç†</li>
</ul>
<p>mapå­˜å‚¨channel idå’ŒChannelHandlerContextã€‚æ–¹ä¾¿å¯¹åœ¨çº¿ç”¨æˆ·è¿›è¡Œç®¡ç†ã€‚</p>
<ul>
<li>ä¸šåŠ¡å¼‚æ­¥åŒ–</li>
</ul>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œnettyæ˜¯æœ‰1ä¸ªbossçº¿ç¨‹æ¥acceptè¿æ¥ï¼Œç„¶ååˆ†ç»™availableProcessors*2ä¸ªworkerçº¿ç¨‹è¿›è¡Œå¤„ç†ã€‚ä¸ºä¸ªæé«˜å¹¶å‘é‡ï¼Œè¿™å‡ ä¸ªworkerçº¿ç¨‹æ˜¯ä¸èƒ½å»åšè€—æ—¶çš„ä¸šåŠ¡æ“ä½œçš„ã€‚åœ¨è¿™é‡Œworkerçº¿ç¨‹åªåšç¼–è§£ç ï¼Œç„¶åæ ¹æ®åè®®çš„actionï¼Œåˆ†å‘åˆ°çº¿ç¨‹æ± ä¸­å¼‚æ­¥æ‰§è¡Œç›¸åº”ä»»åŠ¡ã€‚</p>
<ul>
<li>æ–­çº¿é‡è¿</li>
</ul>
<p>é•¿è¿æ¥çš„ä¿æ´»æ˜¯éå¸¸é‡è¦çš„å·¥ä½œï¼Œåœ¨è¿™é‡Œçš„å®ç°æ˜¯å®¢æˆ·ç«¯ç›‘å¬IdleStateEventäº‹ä»¶ï¼Œæ¯10så‘é€å¿ƒè·³åŒ…ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°å¿ƒè·³åŒ…åä¼šechoç»™å®¢æˆ·ç«¯ï¼›å½“å®¢æˆ·ç«¯25sæ²¡æœ‰æ”¶åˆ°è¯»æ¶ˆæ¯åˆ™è§¦å‘æ–­çº¿é‡è¿ã€‚</p>
<ul>
<li>æ‰©å±•æ€§</li>
</ul>
<p>å®šä¹‰äº†ç®€å•çš„åè®®SimpleProtocol:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> success;(æœ¬æ¬¡åŠ¨ä½œæ˜¯å¦æˆåŠŸ)</div><div class="line"><span class="keyword">private</span> String action;(åŠ¨ä½œç±»å‹)</div><div class="line"><span class="keyword">private</span> String content;(åŠ¨ä½œå†…å®¹)</div></pre></td></tr></table></figure></p>
<p>å¯ä»¥åŸºäºæ­¤åè®®å®ç°è‡ªå·±çš„ä¸šåŠ¡ï¼Œéœ€è¦å®ç°IActionHandleræ¥å£,å½“ç„¶ä¹Ÿå¯ä»¥å®šä¹‰è‡ªå·±çš„åè®®ã€‚</p>
<ul>
<li>ç›‘æ§&amp;&amp;æ¨é€åå°</li>
</ul>
<p>å¯ä»¥çœ‹åˆ°å®æ—¶é•¿è¿æ¥æ•°ï¼Œå¹¶æä¾›äº†æ¨é€å…¥å£ã€‚æ”¯æŒå•ç‚¹æ¨é€å’Œå¹¿æ’­ã€‚</p>
<h3 id="ä»£ç è·¯å¾„"><a href="#ä»£ç è·¯å¾„" class="headerlink" title="ä»£ç è·¯å¾„"></a>ä»£ç è·¯å¾„</h3><p>æœåŠ¡ç«¯ç›¸å…³ä»£ç åœ¨com.fantasy.rivendell.service.serveråŒ…ä¸­ï¼Œå®¢æˆ·ç«¯ç›¸å…³ä»£ç åœ¨com.fantasy.rivendell.service.clientåŒ…ä¸­ï¼Œæ§åˆ¶å°çš„å…¥å£ç±»æ˜¯RivendellControllerã€‚å¦‚æœæœ‰é—®é¢˜æ¬¢è¿æ‰¾æˆ‘è®¨è®ºğŸ˜†ã€‚</p>
<h2 id="æµè§ˆå™¨é•¿è¿æ¥æ–¹æ¡ˆ"><a href="#æµè§ˆå™¨é•¿è¿æ¥æ–¹æ¡ˆ" class="headerlink" title="æµè§ˆå™¨é•¿è¿æ¥æ–¹æ¡ˆ"></a>æµè§ˆå™¨é•¿è¿æ¥æ–¹æ¡ˆ</h2><p>æµè§ˆå™¨å®ç°é•¿è¿æ¥ï¼Œè‡ªç„¶æƒ³åˆ°äº†<a href="https://en.wikipedia.org/wiki/WebSocket" target="_blank" rel="external">websocket</a>ã€‚è¿™é‡Œå°±ä¸ä»‹ç»websocketæ˜¯å¦‚ä½•äº¤æ¢sec-keyå¦‚ä½•upgradeåè®®äº†ï¼Œåªè®²ä¸‹å…·ä½“å®ç°æ–¹æ¡ˆï¼š</p>
<h3 id="åŸç”Ÿå®ç°"><a href="#åŸç”Ÿå®ç°" class="headerlink" title="åŸç”Ÿå®ç°"></a>åŸç”Ÿå®ç°</h3><p>ä¾èµ–tomcatå®¹å™¨7.0.47ä»¥ä¸Šç‰ˆæœ¬ï¼Œå¹¶ä¸”éœ€è¦å¼•å…¥åŒ…ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;javax.websocket&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;javax.websocket-api&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;1.1&lt;/version&gt;</div><div class="line">    &lt;scope&gt;provided&lt;/scope&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure></p>
<p>åœ¨Websocketå¤„ç†ç±»ä¸ŠåŠ æ³¨è§£@ServerEndpoint(â€œ/websocketè·¯å¾„â€)åï¼Œç›‘å¬onOpenã€onMessageã€onCloseæ—¶é—´å³å¯ã€‚æ¯æ¬¡ä¸€ä¸ªæ–°çš„ä¼šè¯éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æœ¬ç±»çš„å®ä¾‹ã€‚æ¯”è¾ƒå°´å°¬çš„æ˜¯ï¼Œè¿™ç§æ–¹å¼å’ŒSpringæ˜¯ä¸å…¼å®¹çš„ï¼Œä¸èƒ½åŒæ—¶ä½¿ç”¨Springè¿›è¡Œbeançš„ç®¡ç†ã€‚</p>
<h3 id="springä¸­çš„å®ç°"><a href="#springä¸­çš„å®ç°" class="headerlink" title="springä¸­çš„å®ç°"></a>springä¸­çš„å®ç°</h3><p>é¦–å…ˆå¼•å…¥spring websocketç›¸å…³çš„åŒ…ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;spring-websocket&lt;/artifactId&gt;</div><div class="line">&lt;/dependency&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;spring-messaging&lt;/artifactId&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure><br>ç»§æ‰¿WebSocketConfigurerç±»ï¼Œé…ç½®websocketå…¥å£ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="meta">@EnableWebSocket</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketConfig</span> <span class="keyword">implements</span> <span class="title">WebSocketConfigurer</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerWebSocketHandlers</span><span class="params">(WebSocketHandlerRegistry registry)</span> </span>&#123;</div><div class="line">        registry.addHandler(renjuHandler(), <span class="string">"/å…¥å£è·¯å¾„"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Bean</span></div><div class="line">    <span class="function"><span class="keyword">public</span> WebSocketHandler <span class="title">bizHandler</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BizHandler();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><br>ä¸šåŠ¡é€»è¾‘å†™åœ¨BizHandlerä¸­ï¼ŒBizHandlerå¯ä»¥ç»§æ‰¿TextWebSocketHandlerï¼Œé‡è½½çˆ¶ç±»å¤„ç†å‡½æ•°ã€‚æ³¨æ„ï¼Œè¿™é‡Œçš„BizHandleræ˜¯ä¸€ä¸ªè¢«springç®¡ç†çš„beanï¼Œè¿™æ ·å°±å¯ä»¥æ„‰å¿«çš„è¿›è¡Œæ³¨å…¥äº†ã€‚</p>
<p>æµè§ˆå™¨ç«¯ç›´æ¥ç”¨html5ä¸­çš„Websocketå°±è¡Œï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> connection = <span class="keyword">new</span> WebSocket(<span class="string">"ws://127.0.0.1:8080/å…¥å£è·¯å¾„"</span>);</div><div class="line">connection.open = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">do</span> some biz...</div><div class="line">&#125;</div><div class="line">connection.onmessage= <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">  <span class="keyword">do</span> some biz...</div><div class="line">&#125;</div></pre></td></tr></table></figure><br>æœ€åé™„ä¸Šä¸€ä¸ªä½¿ç”¨websocketå®ç°çš„åœ¨çº¿äº”å­æ£‹æ¸¸æˆdemo:<a href="https://github.com/majiaji/renju" target="_blank" rel="external">renju</a></p>
<h2 id="æ€è€ƒå’Œæ€»ç»“"><a href="#æ€è€ƒå’Œæ€»ç»“" class="headerlink" title="æ€è€ƒå’Œæ€»ç»“"></a>æ€è€ƒå’Œæ€»ç»“</h2><h3 id="åˆ†å¸ƒå¼ç¯å¢ƒ"><a href="#åˆ†å¸ƒå¼ç¯å¢ƒ" class="headerlink" title="åˆ†å¸ƒå¼ç¯å¢ƒ"></a>åˆ†å¸ƒå¼ç¯å¢ƒ</h3><p>å•å°æœåŠ¡å™¨å¯æ‰“å¼€çš„æœ€å¤§è¿æ¥æ•°æ˜¯æœ‰é™çš„ï¼Œå½“ç”¨æˆ·é‡æ¯”è¾ƒå¤§æ—¶éœ€è¦æä¾›ä¸€ä¸ªé›†ç¾¤æ¥ç»™ç”¨æˆ·å»ºç«‹é•¿è¿æ¥ã€‚åŒæ—¶è¿˜éœ€è¦ä¸€ä¸ªä½ç½®æœåŠ¡ï¼šç”¨æˆ·æ¥è¿æ¥æ—¶ç»è¿‡ä¸€è‡´æ€§hashè®¡ç®—è½åˆ°æŸå°æœºå™¨ä¸Šï¼Œè®°å½•åœ¨ä½ç½®æœåŠ¡ä¸­ï¼›è¦æ¨é€æ—¶è¦é¦–å…ˆæŸ¥è¯¢ä½ç½®æœåŠ¡ï¼Œæ‹¿åˆ°ç”¨æˆ·æ­¤æ—¶è¿åœ¨å“ªå°æœºå™¨ï¼Œä¹‹åå‘è¿™ä¸ªæœºå™¨æŠ•é€’æ¶ˆæ¯ï¼Œè¿›è¡Œæ¨é€ã€‚</p>
<h3 id="é•¿è¿æ¥å®‰å…¨é—®é¢˜"><a href="#é•¿è¿æ¥å®‰å…¨é—®é¢˜" class="headerlink" title="é•¿è¿æ¥å®‰å…¨é—®é¢˜"></a>é•¿è¿æ¥å®‰å…¨é—®é¢˜</h3><p>æ”»å‡»è€…å’Œé•¿è¿æ¥æœåŠ¡å»ºç«‹tcpè¿æ¥ï¼Œè¿™ä¸€æ­¥æ˜¯æ²¡æœ‰åŠæ³•æ ¡éªŒçš„ï¼Œæ‰€ä»¥å¯¹äºsyn floodæ”»å‡»éœ€è¦å…¶ä»–æœºåˆ¶æ¥é˜²å¾¡ã€‚å»ºç«‹è¿æ¥åå¯ä»¥ç”¨éå¯¹ç§°åŠ å¯†æ¥äº¤æ¢å¯¹ç§°åŠ å¯†çš„ç§˜é’¥ï¼Œä¹‹åç»è¿‡å¯¹ç§°ç§˜é’¥åŠ å¯†è§£å¯†è¿›è¡Œä¼ è¾“ã€‚å¯¹äºæœåŠ¡ç«¯æ¥è¯´ï¼Œå¦‚æœæ”¶åˆ°æ— æ³•è¯†åˆ«ï¼Œæˆ–è€…è§£å¯†å¤±è´¥çš„æ¶ˆæ¯ï¼Œç›´æ¥ä¸¢å¼ƒã€‚</p>
<h3 id="é•¿è¿æ¥ä½œä¸ºä»£ç†"><a href="#é•¿è¿æ¥ä½œä¸ºä»£ç†" class="headerlink" title="é•¿è¿æ¥ä½œä¸ºä»£ç†"></a>é•¿è¿æ¥ä½œä¸ºä»£ç†</h3><p>é€šè¿‡é•¿è¿æ¥ä»£ç†è¯·æ±‚åç«¯æœåŠ¡ï¼Œå¯ä»¥é¿å…åˆ›å»ºsocketå’Œä¸‰æ¬¡æ¡æ‰‹çš„æ¶ˆè€—ï¼Œæé«˜æ€§èƒ½ã€‚</p>
<h3 id="é•¿è¿æ¥ä¿æ´»æœºåˆ¶"><a href="#é•¿è¿æ¥ä¿æ´»æœºåˆ¶" class="headerlink" title="é•¿è¿æ¥ä¿æ´»æœºåˆ¶"></a>é•¿è¿æ¥ä¿æ´»æœºåˆ¶</h3><p>é•¿è¿æ¥å¦‚æœä¸å­˜åœ¨äº†æœ‰ä¸¤ç§è¡¨ç°ï¼š1æ˜¯å†ä½¿ç”¨è¿™ä¸ªé€šé“æ—¶ä¼šæ”¶åˆ°å¼‚å¸¸ï¼›2æ˜¯å‘é€çš„å¿ƒè·³åŒ…è¶…è¿‡ä¸€å®šæ—¶é—´æ²¡æœ‰å“åº”ã€‚æ‰€ä»¥åˆ¤æ–­é•¿è¿æ¥æ˜¯å¦å­˜åœ¨éœ€è¦æœ‰å…·ä½“çš„æœºåˆ¶æ¥è§¦å‘ç›‘æµ‹ï¼Œçœ‹æ˜¯å¦ä¼šå‡ºç°è¿™ä¸¤ç§è¡¨ç°ã€‚æœ¬æ–‡ä¸­rivendellé¡¹ç›®å®ç°çš„æ˜¯ç”±å®¢æˆ·ç«¯ä¸»åŠ¨å‘èµ·å¿ƒè·³ç›‘æµ‹ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°å¿ƒè·³æ ¡æµ‹åechoç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ ¹æ®æ‹¿åˆ°echoåé‡ç½®IdleStateã€‚æœåŠ¡ç«¯è¦æœ‰ä¸€ä¸ªæ—¶é—´è½®æ¥ç®¡ç†æ‰€æœ‰è¿æ¥ï¼ŒåŠæ—¶æ¸…ç†æ‰ä¸å­˜åœ¨çš„è¿æ¥çš„ä¸Šä¸‹æ–‡ã€‚</p>
<p>å½“å®¢æˆ·ç«¯åˆ¤æ–­è¿æ¥çœŸçš„ä¸å­˜åœ¨æ—¶ï¼Œè¦æœ‰ä¸€å®šçš„é€€é¿æœºåˆ¶ï¼Œä¸èƒ½ç«‹åˆ»é‡è¿ã€‚</p>
<h3 id="websocketå’Œhttp2"><a href="#websocketå’Œhttp2" class="headerlink" title="websocketå’Œhttp2"></a>websocketå’Œhttp2</h3><p>http2çš„ç‰¹æ€§ä¸­æœ‰ä¸€æ¡æ˜¯æ”¯æŒserver pushï¼Œé‚£ä¹ˆhttp2æ˜¯å¦å¯ä»¥å–ä»£websocketå‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚http2ä¸ºäº†æé«˜æ€§èƒ½ä¹Ÿæœ‰ä¸€ä¸ªæŒä¹…çš„è¿æ¥ï¼Œå®ƒé¼“åŠ±æœåŠ¡ç«¯å°½é‡é•¿ä¹…çš„ç»´æŒè¿™ä¸ªè¿æ¥ï¼Œä½†æ˜¯ä¹Ÿå…è®¸æœåŠ¡ç«¯åœ¨å¿…è¦æ—¶åˆ»å…³æ‰idleçš„è¿æ¥ã€‚æ‰€ä»¥http2å¹¶ä¸èƒ½å–ä»£websocketï¼Œå®ƒä»¬å¯ä»¥äº’ç›¸è¡¥å……ã€‚</p>
<p>æœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿ç•™è¨€æˆ–è€…é‚®ä»¶äº¤æµ~</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä¸ºä»€ä¹ˆè¦é•¿è¿æ¥&quot;&gt;&lt;a href=&quot;#ä¸ºä»€ä¹ˆè¦é•¿è¿æ¥&quot; class=&quot;headerlink&quot; title=&quot;ä¸ºä»€ä¹ˆè¦é•¿è¿æ¥&quot;&gt;&lt;/a&gt;ä¸ºä»€ä¹ˆè¦é•¿è¿æ¥&lt;/h2&gt;&lt;h3 id=&quot;èµ„æºä¸­å¿ƒoræ§åˆ¶ä¸­å¿ƒ&quot;&gt;&lt;a href=&quot;#èµ„æºä¸­å¿ƒoræ§åˆ¶ä¸­å¿ƒ&quot; class=&quot;headerlink&quot; title=&quot;èµ„æºä¸­å¿ƒoræ§åˆ¶ä¸­å¿ƒ&quot;&gt;&lt;/a&gt;èµ„æºä¸­å¿ƒoræ§åˆ¶ä¸­å¿ƒ&lt;/h3&gt;&lt;p&gt;å¾ˆä¹…ä»¥æ¥ï¼ŒæœåŠ¡ç«¯ä¸€ç›´ä½œä¸ºâ€œç»Ÿä¸€èµ„æºä¸­å¿ƒâ€è€Œå­˜åœ¨ï¼Œæ‰€ä»¥åå°å¼€å‘å·¥ç¨‹å¸ˆä»¬çš„åŸºç¡€å·¥ä½œå°±æ˜¯å­˜å‚¨ã€ç»´æŠ¤å’Œç®¡ç†ç”¨æˆ·çš„æ•°æ®ï¼Œç„¶åå¼€æ¥å£ç»™å®¢æˆ·ç«¯&amp;amp;&amp;amp;å‰ç«¯åŒå­¦ä½¿ç”¨ã€‚åæ¥å‡ºç°äº†restfulæ¶æ„é£æ ¼ï¼šä¸€ä¸ªURIä»£è¡¨ä¸€ä¸ªèµ„æºï¼Œå®¢æˆ·ç«¯ç”¨HTTPåè®®çš„æ“ä½œæ–¹å¼ï¼ˆGETã€POSTã€PUTã€DELETEï¼‰å¯¹èµ„æºè¿›è¡Œæ“ä½œï¼Œå³å®Œæˆäº†ä¸æœåŠ¡ç«¯çš„äº¤äº’ã€‚è¿™æ ·çš„è®¾è®¡å¯ä»¥è®©æœåŠ¡ç«¯çš„é€»è¾‘å˜å¾—éå¸¸çš„è½»ï¼ŒçœŸçš„å˜æˆäº†â€œèµ„æºä¸­å¿ƒâ€äº†ã€‚å®¢æˆ·ç«¯å¯ä»¥ä¾æ‰˜æ“ä½œèµ„æºçš„æ¥å£å»å®ç°çœŸæ­£çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ¸²æŸ“ç•Œé¢ã€‚è€ƒè™‘åˆ°ä¸€äº›å¼‚å¸¸æƒ…å†µå¤„ç†ï¼Œé€»è¾‘ä¼šåšçš„æ¯”è¾ƒé‡ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºåå°å¼€å‘åŒå­¦æ¥è¯´ï¼Œä¸€å®šä¸ä¼šæ»¡è¶³äºâ€œèµ„æºç®¡ç†è€…â€è¿™æ ·çš„è§’è‰²ï¼Œæ¯å¤©å†™å†™å¢åˆ æ”¹æŸ¥å’Œå­—ç¬¦ä¸²æ‹¼æ¥ã€‚å› ä¸ºæœ‰é•¿è¿æ¥æŠ€æœ¯çš„å­˜åœ¨ï¼ŒæœåŠ¡ç«¯å¯ä»¥åšæ›´å¤šçš„äº‹æƒ…ã€‚ç›¸å¯¹äºå®¢æˆ·ç«¯æŠŠæœåŠ¡ç«¯å½“æˆâ€œæ•°æ®èµ„æºåº“â€ï¼Œåè¿‡æ¥ï¼ŒæœåŠ¡ç«¯ä¹Ÿå¯ä»¥æŠŠå®¢æˆ·ç«¯çœ‹æˆâ€œUIåº“â€ï¼Œé€šè¿‡é•¿è¿æ¥é€šé“æ¨é€å‘½ä»¤ä¸‹å»ï¼ŒæŒ‡å¯¼å®¢æˆ·ç«¯UIè¿›è¡Œå˜åŒ–ã€‚è¿™æ ·æœåŠ¡ç«¯å°±ä»â€œèµ„æºä¸­å¿ƒâ€å˜æˆäº†â€œæ§åˆ¶ä¸­å¿ƒâ€ã€‚å½“ç„¶è¿™æ˜¯ä¸€ç§æ¯”è¾ƒæç«¯çš„è®¾è®¡ï¼Œé•¿è¿æ¥å¯èƒ½å› ä¸ºç½‘ç»œæˆ–è€…å®¢æˆ·ç«¯ç¯å¢ƒé—®é¢˜æ–­æ‰ï¼Œè¿™æ ·æ§åˆ¶ä¸­å¿ƒå°±å¤±å»æ§åˆ¶èƒ½åŠ›äº†ã€‚æ‰€ä»¥åœ¨å®ç°ä¸šåŠ¡æ—¶å¯ä»¥ç”¨æ¨æ‹‰ç»“åˆçš„æ¨¡å¼ã€‚&lt;/p&gt;
&lt;h3 id=&quot;å³æ—¶è§¦è¾¾çš„èƒ½åŠ›&quot;&gt;&lt;a href=&quot;#å³æ—¶è§¦è¾¾çš„èƒ½åŠ›&quot; class=&quot;headerlink&quot; title=&quot;å³æ—¶è§¦è¾¾çš„èƒ½åŠ›&quot;&gt;&lt;/a&gt;å³æ—¶è§¦è¾¾çš„èƒ½åŠ›&lt;/h3&gt;&lt;p&gt;å› ä¸ºæœ‰äº†é•¿è¿æ¥é€šé“ï¼ŒæœåŠ¡ç«¯æœ‰äº†æ¶ˆæ¯å³æ—¶è§¦è¾¾çš„èƒ½åŠ›ï¼ŒåŒæ—¶é¿å…äº†å®¢æˆ·ç«¯åˆ†å¸ƒå¼æ”»å‡»å¼çš„è½®è¯¢ã€‚è¿™ä¸ªèƒ½åŠ›æ˜¯éå¸¸éå¸¸é‡è¦çš„ï¼Œåœ¨è®¾è®¡åœ¨çº¿ç½‘ç»œæ¸¸æˆã€IMç³»ç»Ÿã€æ¨é€ç³»ç»Ÿæ—¶é•¿è¿æ¥é€šé“ä¸å¯æˆ–ç¼ºã€‚&lt;/p&gt;
&lt;h3 id=&quot;ä¸šç•Œé€šç”¨æ¨é€æ–¹æ³•&quot;&gt;&lt;a href=&quot;#ä¸šç•Œé€šç”¨æ¨é€æ–¹æ³•&quot; class=&quot;headerlink&quot; title=&quot;ä¸šç•Œé€šç”¨æ¨é€æ–¹æ³•&quot;&gt;&lt;/a&gt;ä¸šç•Œé€šç”¨æ¨é€æ–¹æ³•&lt;/h3&gt;&lt;p&gt;ç°åœ¨ç§»åŠ¨ç«¯éƒ½æœ‰è‡ªå·±çš„pushç³»ç»Ÿï¼ŒiOSæœ‰&lt;a href=&quot;https://developer.apple.com/notifications/&quot;&gt;APNS(Apple Push Notification service)&lt;/a&gt;,Androidæœ‰&lt;a href=&quot;https://developers.google.com/cloud-messaging/?hl=zh-cn/&quot;&gt;GCM(Google Cloud Messaging)&lt;/a&gt;ã€‚å¯ä»¥ç®€å•ç†è§£ä¸ºå®˜æ–¹çš„ä¸€ä¸ªæœåŠ¡å’Œç§»åŠ¨å®¢æˆ·ç«¯å»ºç«‹äº†ä¸€ä¸ªé•¿è¿æ¥ï¼Œæ‰€æœ‰çš„appå…±ç”¨è¿™æ¡é€šé“ï¼Œæ¯æ¬¡æ¨é€æ—¶è¦ç”¨è‡ªå·±çš„æœåŠ¡è°ƒç”¨ä¸€ä¸‹å®˜æ–¹æœåŠ¡çš„æ¥å£ï¼Œç„¶åç”±å®˜æ–¹çš„æœåŠ¡è¿›è¡Œæ¨é€ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°æ¨é€åä¼šåœ¨ç³»ç»Ÿé€šçŸ¥æ çœ‹åˆ°appæ¨é€çš„ä¸€ä¸ªæ¦‚è¦ä¿¡æ¯ï¼Œç”¨æˆ·ç‚¹å‡»è¿™æ¡push,ä¼šå”¤èµ·å¯¹åº”çš„appï¼Œè¿›å…¥appåä¼šè°ƒç”¨appè‡ªå·±çš„æœåŠ¡æ¥å£æ‹‰å–æ›´å¤šçš„ä¸šåŠ¡æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºå“ˆå“ˆå“ˆå“ˆçš„åŸå› ï¼ŒGCMåœ¨å›½å†…å‡ ä¹ä¸èƒ½ä½¿ç”¨ï¼›å¦‚æœåº”ç”¨æœ‰pcç«¯è¿˜è¦æ”¯æŒpcç«¯çš„æ¨é€;ä¸šåŠ¡æ¯”è¾ƒå¤æ‚æ—¶ä¼šå¸Œæœ›è®¾è®¡ä¸€ç§æ›´é«˜æ•ˆçµæ´»çš„æ¨é€åè®®ã€‚åŸºäºä»¥ä¸ŠåŸå› ï¼Œå¼€å‘è€…ä¼šè®¾è®¡è‡ªå·±çš„é•¿è¿æ¥é€šé“å’Œæ¨é€åè®®ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="åå°" scheme="https://majiaji.github.io/categories/%E5%90%8E%E5%8F%B0/"/>
    
    
      <category term="åå°" scheme="https://majiaji.github.io/tags/%E5%90%8E%E5%8F%B0/"/>
    
      <category term="é•¿è¿æ¥" scheme="https://majiaji.github.io/tags/%E9%95%BF%E8%BF%9E%E6%8E%A5/"/>
    
      <category term="æ¨é€" scheme="https://majiaji.github.io/tags/%E6%8E%A8%E9%80%81/"/>
    
  </entry>
  
  <entry>
    <title>Guava Cache</title>
    <link href="https://majiaji.github.io/2016/12/11/Guava-Cache/"/>
    <id>https://majiaji.github.io/2016/12/11/Guava-Cache/</id>
    <published>2016-12-11T05:31:42.000Z</published>
    <updated>2016-12-11T17:28:32.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Guava-Cacheç®€ä»‹"><a href="#Guava-Cacheç®€ä»‹" class="headerlink" title="Guava Cacheç®€ä»‹"></a>Guava Cacheç®€ä»‹</h2><p>Local Cacheæ˜¯æ¯”è¾ƒå¸¸ç”¨çš„åç«¯å¼€å‘â€œç»„ä»¶â€ï¼ŒGuavaä¸­çš„Cacheæ˜¯ä¸€ä¸ªå¾ˆå®ç”¨çš„Local Cacheçš„å®ç°ï¼Œå®ƒæ”¯æŒä¸‹åˆ—ç‰¹æ€§ï¼š</p>
<ul>
<li>automatic loading of entries into the cache</li>
<li>least-recently-used eviction when a maximum size is exceeded</li>
<li>time-based expiration of entries, measured since last access or last write</li>
<li>keys automatically wrapped in weak references</li>
<li>values automatically wrapped in weak or soft references</li>
<li>notification of evicted (or otherwise removed) entries</li>
<li>accumulation of cache access statistics</li>
</ul>
<p>è¿™äº›ç‰¹æ€§éƒ½æ˜¯å¯é€‰çš„ï¼Œå¯åœ¨åˆå§‹åŒ–æ—¶çš„å»ºé€ è€…æ¨¡å¼ä¸­è¿›è¡Œé…ç½®ã€‚<br>ä»Šå¤©ä¸»è¦æ ¹æ®æºç æ¥è®²ä¸€ä¸‹Guava Cacheï¼ˆ19.0ï¼‰çš„å®ç°ï¼Œå…·ä½“çš„åº”ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒ<a href="https://github.com/google/guava/wiki/CachesExplained" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<a id="more"></a>
<h2 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h2><h3 id="â€œè¿‡æœŸâ€ç­–ç•¥ä»‹ç»"><a href="#â€œè¿‡æœŸâ€ç­–ç•¥ä»‹ç»" class="headerlink" title="â€œè¿‡æœŸâ€ç­–ç•¥ä»‹ç»"></a>â€œè¿‡æœŸâ€ç­–ç•¥ä»‹ç»</h3><p>åœ¨è®²æºç ä¹‹å‰é¦–å…ˆä»‹ç»ä¸¤ä¸ªå¸¸ç”¨çš„è¿‡æœŸç­–ç•¥ï¼šexpireAfterWriteå’ŒrefreshAfterWriteã€‚è¿™ä¸¤ä¸ªç­–ç•¥éƒ½èƒ½ä¿è¯åœ¨æœ¬åœ°ç¼“å­˜è¿‡æœŸæ—¶ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å»åŠ è½½åç«¯èµ„æºï¼ˆè¿œç«¯ç¼“å­˜æˆ–è€…db)ã€‚ä¸åŒçš„æ˜¯ï¼Œåœ¨åŠ è½½èµ„æºæ—¶ï¼ŒexpireAfterWriteä¼šè®©æ‰€æœ‰çš„çº¿ç¨‹é˜»å¡ç­‰å¾…æ–°å€¼è¿”å›,ç„¶åè¿”å›åŠ è½½å¥½çš„æ–°å€¼ï¼›è€ŒrefreshAfterWriteåœ¨ä¸€ä¸ªçº¿ç¨‹å»æ‹¿æ–°å€¼çš„åŒæ—¶ï¼Œå…¶ä»–çº¿ç¨‹å…ˆç›´æ¥è¿”å›æ—§å€¼ï¼Œä¸é˜»å¡ã€‚</p>
<p>getæ–¹æ³•ä¸»è¦å®ç°äº†ä¸Šè¿°é€»è¾‘ã€‚</p>
<h3 id="getåˆ†æ"><a href="#getåˆ†æ" class="headerlink" title="getåˆ†æ"></a>getåˆ†æ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// loading</span></div><div class="line"></div><div class="line">     <span class="function">V <span class="title">get</span><span class="params">(K key, <span class="keyword">int</span> hash, CacheLoader&lt;? <span class="keyword">super</span> K, V&gt; loader)</span> <span class="keyword">throws</span> ExecutionException </span>&#123;</div><div class="line">      checkNotNull(key);</div><div class="line">      checkNotNull(loader);</div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">        <span class="comment">//countæ˜¯è¿™ä¸ªsegmentä¸­â€œå­˜æ´»â€çš„å…ƒç´ æ•°é‡ï¼Œç¬¬ä¸€æ¬¡å‘½ä¸­æ—¶ä¸º0</span></div><div class="line">        <span class="keyword">if</span> (count != <span class="number">0</span>) &#123; <span class="comment">// read-volatile</span></div><div class="line">          <span class="comment">// don't call getLiveEntry, which would ignore loading values</span></div><div class="line">          ReferenceEntry&lt;K, V&gt; e = getEntry(key, hash);</div><div class="line">          <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">long</span> now = map.ticker.read();</div><div class="line">            <span class="comment">//è·å–æœ‰æ•ˆçš„ï¼Œä¸”æ²¡æœ‰è¿‡æœŸçš„å€¼</span></div><div class="line">            V value = getLiveValue(e, now);</div><div class="line">            <span class="keyword">if</span> (value != <span class="keyword">null</span>) &#123;</div><div class="line">              <span class="comment">//CacheStatsæ‰“ç‚¹è®°å½•</span></div><div class="line">              recordRead(e, now);</div><div class="line">              statsCounter.recordHits(<span class="number">1</span>);</div><div class="line">              <span class="comment">//refreshçš„é€»è¾‘ï¼Œä¸é˜»å¡å…ˆè¿”å›æ—§å€¼</span></div><div class="line">              <span class="keyword">return</span> scheduleRefresh(e, key, hash, value, now, loader);</div><div class="line">            &#125;</div><div class="line">            ValueReference&lt;K, V&gt; valueReference = e.getValueReference();</div><div class="line">            <span class="keyword">if</span> (valueReference.isLoading()) &#123;</div><div class="line">              <span class="comment">//å·²ç»æœ‰ä¸€ä¸ªçº¿ç¨‹å»loadäº†ï¼Œè¿™é‡ŒåŒæ­¥ç­‰å¾…è¿”å›çš„æ–°å€¼</span></div><div class="line">              <span class="keyword">return</span> waitForLoadingValue(e, key, valueReference);</div><div class="line">            &#125;</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// at this point e is either null or expired;</span></div><div class="line">        <span class="comment">//æ‹¿é”å¹¶è¿”å›å·²ç»å­˜åœ¨çš„å€¼ï¼Œæˆ–è€…è¿›è¡ŒåŒæ­¥çš„load</span></div><div class="line">        <span class="keyword">return</span> lockedGetOrLoad(key, hash, loader);</div><div class="line">      &#125; <span class="keyword">catch</span> (ExecutionException ee) &#123;</div><div class="line">        Throwable cause = ee.getCause();</div><div class="line">        <span class="keyword">if</span> (cause <span class="keyword">instanceof</span> Error) &#123;</div><div class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> ExecutionError((Error) cause);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cause <span class="keyword">instanceof</span> RuntimeException) &#123;</div><div class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> UncheckedExecutionException(cause);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">throw</span> ee;</div><div class="line">      &#125; <span class="keyword">finally</span> &#123;</div><div class="line">        postReadCleanup();</div><div class="line">      &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>getä¸­çš„scheduleRefresh:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function">V <span class="title">scheduleRefresh</span><span class="params">(ReferenceEntry&lt;K, V&gt; entry, K key, <span class="keyword">int</span> hash, V oldValue, <span class="keyword">long</span> now,</span></span></div><div class="line">       CacheLoader&lt;? <span class="keyword">super</span> K, V&gt; loader) &#123;</div><div class="line">     <span class="keyword">if</span> (map.refreshes() &amp;&amp; (now - entry.getWriteTime() &gt; map.refreshNanos)</div><div class="line">         &amp;&amp; !entry.getValueReference().isLoading()) &#123;</div><div class="line">         <span class="comment">//å¦‚æœæ²¡æœ‰çº¿ç¨‹åœ¨loadingï¼Œåˆ™å»loadæ–°å€¼</span></div><div class="line">       V newValue = refresh(key, hash, loader, <span class="keyword">true</span>);</div><div class="line">       <span class="keyword">if</span> (newValue != <span class="keyword">null</span>) &#123;</div><div class="line">         <span class="keyword">return</span> newValue;</div><div class="line">       &#125;</div><div class="line">     &#125;</div><div class="line">     <span class="comment">//å¦åˆ™ç›´æ¥è¿”å›æ—§å€¼</span></div><div class="line">     <span class="keyword">return</span> oldValue;</div><div class="line">   &#125;</div><div class="line"></div></pre></td></tr></table></figure><br>getä¸­çš„lockedGetOrLoad:<br>ä¸€èˆ¬ç¬¬ä¸€æ¬¡åŠ è½½æŸä¸ªkeyå¯¹åº”çš„valueï¼Œæˆ–è€…expireAfterWriteç­–ç•¥ä¸­valueè¿‡æœŸæ—¶ä¼šè¿›å…¥åˆ°è¿™ä¸ªå‡½æ•°ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function">V <span class="title">lockedGetOrLoad</span><span class="params">(K key, <span class="keyword">int</span> hash, CacheLoader&lt;? <span class="keyword">super</span> K, V&gt; loader)</span></span></div><div class="line">        <span class="keyword">throws</span> ExecutionException &#123;</div><div class="line">      ReferenceEntry&lt;K, V&gt; e;</div><div class="line">      ValueReference&lt;K, V&gt; valueReference = <span class="keyword">null</span>;</div><div class="line">      LoadingValueReference&lt;K, V&gt; loadingValueReference = <span class="keyword">null</span>;</div><div class="line">      <span class="keyword">boolean</span> createNewEntry = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">      lock();</div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">        <span class="comment">// re-read ticker once inside the lock</span></div><div class="line">        <span class="keyword">long</span> now = map.ticker.read();</div><div class="line">        preWriteCleanup(now);</div><div class="line"></div><div class="line">        <span class="keyword">int</span> newCount = <span class="keyword">this</span>.count - <span class="number">1</span>;</div><div class="line">        AtomicReferenceArray&lt;ReferenceEntry&lt;K, V&gt;&gt; table = <span class="keyword">this</span>.table;</div><div class="line">        <span class="keyword">int</span> index = hash &amp; (table.length() - <span class="number">1</span>);</div><div class="line">        ReferenceEntry&lt;K, V&gt; first = table.get(index);</div><div class="line"></div><div class="line">        <span class="comment">//æ‰¾åˆ°å…ƒç´ åˆ¤æ–­æ˜¯å¦è¿‡æœŸï¼Œè¿”å›æˆ–è€…æ‰§è¡Œæ¸…ç†</span></div><div class="line">        <span class="keyword">for</span> (e = first; e != <span class="keyword">null</span>; e = e.getNext()) &#123;</div><div class="line">          K entryKey = e.getKey();</div><div class="line">          <span class="keyword">if</span> (e.getHash() == hash &amp;&amp; entryKey != <span class="keyword">null</span></div><div class="line">              &amp;&amp; map.keyEquivalence.equivalent(key, entryKey)) &#123;</div><div class="line">            valueReference = e.getValueReference();</div><div class="line">            <span class="keyword">if</span> (valueReference.isLoading()) &#123;</div><div class="line">              createNewEntry = <span class="keyword">false</span>;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">              V value = valueReference.get();</div><div class="line">              <span class="keyword">if</span> (value == <span class="keyword">null</span>) &#123;</div><div class="line">                enqueueNotification(entryKey, hash, valueReference, RemovalCause.COLLECTED);</div><div class="line">              &#125; <span class="keyword">else</span> <span class="keyword">if</span> (map.isExpired(e, now)) &#123;</div><div class="line">                <span class="comment">// This is a duplicate check, as preWriteCleanup already purged expired</span></div><div class="line">                <span class="comment">// entries, but let's accomodate an incorrect expiration queue.</span></div><div class="line">                enqueueNotification(entryKey, hash, valueReference, RemovalCause.EXPIRED);</div><div class="line">              &#125; <span class="keyword">else</span> &#123;</div><div class="line">                recordLockedRead(e, now);</div><div class="line">                statsCounter.recordHits(<span class="number">1</span>);</div><div class="line">                <span class="comment">// we were concurrent with loading; don't consider refresh</span></div><div class="line">                <span class="keyword">return</span> value;</div><div class="line">              &#125;</div><div class="line"></div><div class="line">              <span class="comment">// immediately reuse invalid entries</span></div><div class="line">              writeQueue.remove(e);</div><div class="line">              accessQueue.remove(e);</div><div class="line">              <span class="keyword">this</span>.count = newCount; <span class="comment">// write-volatile</span></div><div class="line">            &#125;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line"><span class="comment">//æ–°å»ºçš„å…ƒç´ ï¼Œå…ˆåšä¸€äº›åˆå§‹åŒ–çš„åŠ¨ä½œ</span></div><div class="line">        <span class="keyword">if</span> (createNewEntry) &#123;</div><div class="line">          loadingValueReference = <span class="keyword">new</span> LoadingValueReference&lt;K, V&gt;();</div><div class="line"></div><div class="line">          <span class="keyword">if</span> (e == <span class="keyword">null</span>) &#123;</div><div class="line">            e = newEntry(key, hash, first);</div><div class="line">            e.setValueReference(loadingValueReference);</div><div class="line">            table.set(index, e);</div><div class="line">          &#125; <span class="keyword">else</span> &#123;</div><div class="line">            e.setValueReference(loadingValueReference);</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125; <span class="keyword">finally</span> &#123;</div><div class="line">        unlock();</div><div class="line">        postWriteCleanup();</div><div class="line">      &#125;</div><div class="line"></div><div class="line"><span class="comment">//æ–°å»ºçš„å…ƒç´ ï¼ŒåŒæ­¥å»è¿œç«¯loadå€¼</span></div><div class="line">      <span class="keyword">if</span> (createNewEntry) &#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">          <span class="comment">// Synchronizes on the entry to allow failing fast when a recursive load is</span></div><div class="line">          <span class="comment">// detected. This may be circumvented when an entry is copied, but will fail fast most</span></div><div class="line">          <span class="comment">// of the time.</span></div><div class="line">          <span class="keyword">synchronized</span> (e) &#123;</div><div class="line">            <span class="keyword">return</span> loadSync(key, hash, loadingValueReference, loader);</div><div class="line">          &#125;</div><div class="line">        &#125; <span class="keyword">finally</span> &#123;</div><div class="line">          statsCounter.recordMisses(<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// The entry already exists. Wait for loading.</span></div><div class="line">        <span class="comment">//å¦åˆ™é˜»å¡ç­‰å¾…åˆ«çš„çº¿ç¨‹load</span></div><div class="line">        <span class="keyword">return</span> waitForLoadingValue(e, key, valueReference);</div><div class="line">      &#125;</div><div class="line">    &#125; </div></pre></td></tr></table></figure></p>
<p>getä¸­çš„waitForLoadingValue:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function">V <span class="title">waitForLoadingValue</span><span class="params">(ReferenceEntry&lt;K, V&gt; e, K key, ValueReference&lt;K, V&gt; valueReference)</span></span></div><div class="line">       <span class="keyword">throws</span> ExecutionException &#123;</div><div class="line">     <span class="keyword">if</span> (!valueReference.isLoading()) &#123;</div><div class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError();</div><div class="line">     &#125;</div><div class="line"></div><div class="line">     checkState(!Thread.holdsLock(e), <span class="string">"Recursive load of: %s"</span>, key);</div><div class="line">     <span class="comment">// don't consider expiration as we're concurrent with loading</span></div><div class="line">     <span class="keyword">try</span> &#123;</div><div class="line">      <span class="comment">//getUninterruptiblyåŒæ­¥è·å–</span></div><div class="line">       V value = valueReference.waitForValue();</div><div class="line">       <span class="keyword">if</span> (value == <span class="keyword">null</span>) &#123;</div><div class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> InvalidCacheLoadException(<span class="string">"CacheLoader returned null for key "</span> + key + <span class="string">"."</span>);</div><div class="line">       &#125;</div><div class="line">       <span class="comment">// re-read ticker now that loading has completed</span></div><div class="line">       <span class="keyword">long</span> now = map.ticker.read();</div><div class="line">       recordRead(e, now);</div><div class="line">       <span class="keyword">return</span> value;</div><div class="line">     &#125; <span class="keyword">finally</span> &#123;</div><div class="line">       statsCounter.recordMisses(<span class="number">1</span>);</div><div class="line">     &#125;</div><div class="line">   &#125;</div><div class="line"></div></pre></td></tr></table></figure><br>è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œå¦‚æœåœ¨guava cacheä¸­ï¼Œå»è¿œç«¯loadå›ç»“æœä¸ºnullï¼Œè¿™æ—¶ä¸ä¼šè¿”å›nullï¼Œè€Œæ˜¯ç›´æ¥æŠ›å¼‚å¸¸InvalidCacheLoadExceptionå‡ºæ¥ã€‚åœ¨dbæ“ä½œä¸­ï¼Œloadç»“æœä¸ºnullæ˜¯å¾ˆå¸¸è§çš„ï¼Œæ‰€ä»¥ä¸€å®šè¦æ³¨æ„å¤„ç†è¿™ç‚¹ã€‚</p>
<p>ç›®å‰çš„è§£å†³åŠæ³•æ˜¯ï¼Œæ‹¿åˆ°dbè¿”å›ç»“æœæ—¶å…ˆåˆ¤æ–­ä¸‹æ˜¯å¦ä¸ºnullï¼Œå¦‚æœä¸ºnullåˆ™è¿”å›ä¸€ä¸ªç©ºå¯¹è±¡å‡ºå»ã€‚å¤–è¾¹å‡½æ•°æ‹¿åˆ°getçš„ç»“æœåå…ˆå–è¿™ä¸ªå¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼Œæ¯”å¦‚ä¸€ä¸ªDOçš„idï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºnullï¼Œå¦‚æœä¸ºnullåˆ™è¿”å›nullï¼Œå¦åˆ™è¿”å›å¯¹è±¡æœ¬èº«ã€‚</p>
<h2 id="æ€è€ƒå’Œæ€»ç»“"><a href="#æ€è€ƒå’Œæ€»ç»“" class="headerlink" title="æ€è€ƒå’Œæ€»ç»“"></a>æ€è€ƒå’Œæ€»ç»“</h2><p>ä»ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼ŒGuava Cacheä¸ç®¡æ˜¯å“ªç§è¿‡æœŸç­–ç•¥ï¼Œéƒ½æ˜¯è§¦å‘å¼çš„ï¼šå³æ¯ä¸€æ¬¡çš„è¿‡æœŸå’ŒreloadåŠ¨ä½œéƒ½ä¾èµ–å¤–éƒ¨çš„è¯·æ±‚ã€‚æ‰€è°“çš„refreshå¹¶ä¸æ˜¯è‡ªå·±èµ·äº†ä¸€ä¸ªçº¿ç¨‹å»ä¸åœçš„reloadã€‚åœ¨getLiveValueæ–¹æ³•ä¸­åˆ¤æ–­è¿‡æœŸå…ƒç´ ä¹Ÿä¸åŒ…æ‹¬refreshç­–ç•¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isExpired</span><span class="params">(ReferenceEntry&lt;K, V&gt; entry, <span class="keyword">long</span> now)</span> </span>&#123;</div><div class="line">   checkNotNull(entry);</div><div class="line">   <span class="keyword">if</span> (expiresAfterAccess()</div><div class="line">       &amp;&amp; (now - entry.getAccessTime() &gt;= expireAfterAccessNanos)) &#123;</div><div class="line">     <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">if</span> (expiresAfterWrite()</div><div class="line">       &amp;&amp; (now - entry.getWriteTime() &gt;= expireAfterWriteNanos)) &#123;</div><div class="line">     <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line"> &#125;</div><div class="line"></div></pre></td></tr></table></figure>
<p>è¿™æ ·çš„è¯ï¼Œå¦‚æœç”¨äº†refreshAfterWriteï¼Œåœ¨loadå®Œä¸€ä¸ªå€¼ä¹‹åï¼Œè¿‡äº†å¾ˆä¹…åŒæ—¶æ¥äº†ä¸€æ‹¨å¹¶å‘è¯·æ±‚ï¼Œé‚£ä¹ˆå¤§é‡è¯·æ±‚éƒ½ä¼šæ‹¿åˆ°æ—§çš„å€¼ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸šåŠ¡ä¸Šçš„é—®é¢˜ã€‚ä¸è¿‡è¿™ç§åœºæ™¯ä¹Ÿæ˜¯æœ‰ç‚¹ç•¥å¥‡è‘©ï¼Œä¸å¤ªå¸¸è§ã€‚æ‰€ä»¥åœ¨ä½¿ç”¨å„ä¸ªç‰¹æ€§æ—¶ä¸€å®šè¦ç»“åˆè‡ªå·±çš„ä¸šåŠ¡ï¼Œå¦‚æœä¸ç¡®å®šæœ€å¥½å…ˆå†™ä¸ªå°çš„demoè¯•ä¸€ä¸‹ã€‚æœ€åå†æä¸€ä¸‹ï¼ŒexpireAfterWriteå’ŒrefreshAfterWriteæ˜¯å¯ä»¥ä¸€èµ·ä½¿ç”¨çš„ï¼Œå®˜æ–¹æ–‡æ¡£ä¸­ä¹Ÿæœ‰è¯´æ˜:<br><blockquote><p>In contrast to expireAfterWrite, refreshAfterWrite will make a key eligible for refresh after the specified duration, but a refresh will only be actually initiated when the entry is queried. (If CacheLoader.reload is implemented to be asynchronous, then the query will not be slowed down by the refresh.) So, for example, you can specify both refreshAfterWrite and expireAfterWrite on the same cache, so that the expiration timer on an entry isnâ€™t blindly reset whenever an entry becomes eligible for a refresh, so if an entry isnâ€™t queried after it comes eligible for refreshing, it is allowed to expire.</p>
</blockquote></p>
<p>Guava Cacheçš„è®¾è®¡æ˜¯å¾ˆå¥½çš„ï¼Œä½†æ˜¯æ„Ÿè§‰å®ç°ä¸Šä¸å¤Ÿâ€œä¼˜é›…â€ï¼Œä»£ç è¯»èµ·æ¥æœ‰ç‚¹éš¾å—ï¼Œæ•´ä¸ªå­¦ä¹ è¿‡ç¨‹æ˜¯çŒœæµ‹-&gt;éªŒè¯-&gt;æ˜ç™½ã€‚å¦‚æœæœ‰é—®é¢˜æ¬¢è¿è®¨è®ºäº¤æµ~</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Guava-Cacheç®€ä»‹&quot;&gt;&lt;a href=&quot;#Guava-Cacheç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;Guava Cacheç®€ä»‹&quot;&gt;&lt;/a&gt;Guava Cacheç®€ä»‹&lt;/h2&gt;&lt;p&gt;Local Cacheæ˜¯æ¯”è¾ƒå¸¸ç”¨çš„åç«¯å¼€å‘â€œç»„ä»¶â€ï¼ŒGuavaä¸­çš„Cacheæ˜¯ä¸€ä¸ªå¾ˆå®ç”¨çš„Local Cacheçš„å®ç°ï¼Œå®ƒæ”¯æŒä¸‹åˆ—ç‰¹æ€§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;automatic loading of entries into the cache&lt;/li&gt;
&lt;li&gt;least-recently-used eviction when a maximum size is exceeded&lt;/li&gt;
&lt;li&gt;time-based expiration of entries, measured since last access or last write&lt;/li&gt;
&lt;li&gt;keys automatically wrapped in weak references&lt;/li&gt;
&lt;li&gt;values automatically wrapped in weak or soft references&lt;/li&gt;
&lt;li&gt;notification of evicted (or otherwise removed) entries&lt;/li&gt;
&lt;li&gt;accumulation of cache access statistics&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™äº›ç‰¹æ€§éƒ½æ˜¯å¯é€‰çš„ï¼Œå¯åœ¨åˆå§‹åŒ–æ—¶çš„å»ºé€ è€…æ¨¡å¼ä¸­è¿›è¡Œé…ç½®ã€‚&lt;br&gt;ä»Šå¤©ä¸»è¦æ ¹æ®æºç æ¥è®²ä¸€ä¸‹Guava Cacheï¼ˆ19.0ï¼‰çš„å®ç°ï¼Œå…·ä½“çš„åº”ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒ&lt;a href=&quot;https://github.com/google/guava/wiki/CachesExplained&quot;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt;ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="åå°" scheme="https://majiaji.github.io/categories/%E5%90%8E%E5%8F%B0/"/>
    
    
      <category term="Guava" scheme="https://majiaji.github.io/tags/Guava/"/>
    
      <category term="åå°" scheme="https://majiaji.github.io/tags/%E5%90%8E%E5%8F%B0/"/>
    
  </entry>
  
  <entry>
    <title>Guava BloomFilter</title>
    <link href="https://majiaji.github.io/2016/12/04/Guava-BloomFilter/"/>
    <id>https://majiaji.github.io/2016/12/04/Guava-BloomFilter/</id>
    <published>2016-12-04T14:00:12.000Z</published>
    <updated>2016-12-04T17:30:08.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="BloomFilterç®€ä»‹"><a href="#BloomFilterç®€ä»‹" class="headerlink" title="BloomFilterç®€ä»‹"></a>BloomFilterç®€ä»‹</h2><p>BloomFilteræ˜¯ä¸€ä¸ªå¯ä»¥å¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­çš„ç»„ä»¶ï¼Œå®ƒçš„è®¾è®¡ä¹Ÿæ¯”è¾ƒå®¹æ˜“ç†è§£ï¼šæ„å»ºçš„æ—¶å€™ï¼Œä¸€ä¸ªå…ƒç´ ç»è¿‡å‡ ä¸ªhashå‡½æ•°hashåï¼Œå‘½ä¸­ä¸€ä¸ªbitæ•°ç»„çš„ä¸åŒçš„ä½ç‚¹ï¼Œå¹¶æŠŠä½ç‚¹ç½®ä¸º1ã€‚åœ¨åˆ¤æ–­çš„æ—¶å€™ï¼Œä¹Ÿè¦æ‰§è¡ŒåŒæ ·çš„hashå‡½æ•°ï¼Œåªè¦æœ‰ä¸€ä¸ªæ²¡æœ‰å‘½ä¸­åˆ™è¿™ä¸ªå…ƒç´ ä¸€å®šä¸å­˜åœ¨ï¼›å¦åˆ™æœ‰å¯èƒ½å­˜åœ¨ã€‚åªä¼šæœ‰ä¸€ç§â€œè¯¯åˆ¤â€çš„æƒ…å†µï¼šå…ƒç´ ä¸åœ¨é›†åˆä¸­ï¼Œä½†è¢«åˆ¤æ–­ä¸ºåœ¨é›†åˆä¸­ã€‚</p>
<p>å› ä¸ºæ„å»ºæ—¶å€™å¤šä¸ªå…ƒç´ ç»è¿‡hashå¯èƒ½å‘½ä¸­åŒæ ·çš„ä½ç‚¹ï¼Œè¿™æ ·ä¼šå½±å“åˆ¤æ–­æ—¶å€™çš„å‡†ç¡®ç‡ã€‚å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œbitæ•°ç»„è¶Šå¤§ï¼Œhashå‡½æ•°æ•£åˆ—æ•ˆæœè¶Šå¥½ï¼Œè¿™æ ·â€œå†²çªâ€çš„æ¦‚ç‡è¶Šå°ï¼Œåˆ¤æ–­çš„æ­£ç¡®ç‡è¶Šé«˜ã€‚ä½†æ˜¯ï¼Œæ‰©å¤§bitæ•°ç»„ä¼šå ç”¨æ›´å¤šå†…å­˜ï¼Œhashå‡½æ•°è®¡ç®—å¤æ‚åº¦å’Œæ•°é‡ä¼šå½±å“è®¡ç®—é€Ÿåº¦ã€‚æ‰€ä»¥å¦‚ä½•å¹³è¡¡æ­£ç¡®ç‡ä¸bitæ•°ç»„é•¿åº¦ã€hashå‡½æ•°çš„ä¸ªæ•°å‘¢ï¼Ÿæœ‰ä¸€ä¸ªå…¬å¼ï¼š</p>
<p>å‡è®¾mæ˜¯bitæ•°ç»„çš„bitçš„æ•°é‡(é•¿åº¦)ï¼Œkæ˜¯hashå‡½æ•°çš„æ•°é‡ï¼Œnæ˜¯åœ¨æ„é€ æ—¶å…ƒç´ çš„æ•°é‡,pä¸ºåˆ¤æ–­æ—¶çš„é”™è¯¯ç‡ã€‚åˆ™å½“å®ƒä»¬æ»¡è¶³ä¸‹è¾¹ä¸¤ä¸ªå…¬å¼æ—¶ï¼Œæœ‰è¿‘ä¼¼æœ€ä¼˜è§£ã€‚</p>
<blockquote><ol>
<li><p>m = -n * lnp / (ln2)^2 </p>
</li>
<li><p>k = m / n * ln2 </p>
</li>
</ol>
</blockquote>
<p>å…·ä½“çš„æ¨å¯¼è¿‡ç¨‹å¯ä»¥çœ‹ä¸‹<a href="https://en.wikipedia.org/wiki/Bloom_filter#Probability_of_false_positives" target="_blank" rel="external">è¿™é‡Œã€‚</a><br><a id="more"></a></p>
<h2 id="Guavaä¸­çš„å®ç°"><a href="#Guavaä¸­çš„å®ç°" class="headerlink" title="Guavaä¸­çš„å®ç°"></a>Guavaä¸­çš„å®ç°</h2><p>Guavaä¸­æœ‰ä¸€ä¸ªBloomFilterçš„å®ç°ï¼Œä¸‹é¢æ¥åˆ†æå…·ä½“çš„å®ç°æ–¹æ³•ï¼š</p>
<h3 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h3><p>Guavaçš„BloomFilteræä¾›ä¸€ä¸ªé™æ€çš„åˆ›å»ºæ–¹æ³•ï¼Œæ”¯æŒä¸‰ä¸ªå‚æ•°ï¼š</p>
<ol>
<li>Funnel&lt;? super T&gt;  è½¬ä¸ºPrimitiveSinkçš„å¯¹è±¡çš„ç±»å‹ï¼Œæ¨èä½¿ç”¨enumã€‚Funnelsä¸­æ”¯æŒä¸€äº›åŸºç¡€ç±»å‹ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å®ç°ã€‚</li>
<li>expectedInsertions é¢„ä¼°çš„æ„é€ æ—¶å…ƒç´ çš„æ•°é‡ï¼Œå³å…¬å¼ä¸­çš„nã€‚</li>
<li>fpp é”™è¯¯ç‡ï¼Œå³å…¬å¼ä¸­çš„pï¼ŒèŒƒå›´ä¸º0-1.0</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">static</span> &lt;T&gt; <span class="function">BloomFilter&lt;T&gt; <span class="title">create</span><span class="params">(</span></span></div><div class="line">     Funnel&lt;? <span class="keyword">super</span> T&gt; funnel, <span class="keyword">long</span> expectedInsertions, <span class="keyword">double</span> fpp, Strategy strategy) &#123;</div><div class="line">   checkNotNull(funnel);</div><div class="line">   checkArgument(</div><div class="line">       expectedInsertions &gt;= <span class="number">0</span>, <span class="string">"Expected insertions (%s) must be &gt;= 0"</span>, expectedInsertions);</div><div class="line">   checkArgument(fpp &gt; <span class="number">0.0</span>, <span class="string">"False positive probability (%s) must be &gt; 0.0"</span>, fpp);</div><div class="line">   checkArgument(fpp &lt; <span class="number">1.0</span>, <span class="string">"False positive probability (%s) must be &lt; 1.0"</span>, fpp);</div><div class="line">   checkNotNull(strategy);</div><div class="line"></div><div class="line">   <span class="keyword">if</span> (expectedInsertions == <span class="number">0</span>) &#123;</div><div class="line">     expectedInsertions = <span class="number">1</span>;</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">   <span class="comment">//æ ¹æ®å…¬å¼1. è®¡ç®—bitæ•°ç»„çš„bitçš„æ•°m</span></div><div class="line">   <span class="keyword">long</span> numBits = optimalNumOfBits(expectedInsertions, fpp);</div><div class="line">   <span class="comment">//æ ¹æ®å…¬å¼2. è®¡ç®—hashå‡½æ•°(æ‰§è¡Œhashæ¬¡æ•°)çš„æ•°é‡k</span></div><div class="line">   <span class="keyword">int</span> numHashFunctions = optimalNumOfHashFunctions(expectedInsertions, numBits);</div><div class="line">   <span class="keyword">try</span> &#123;</div><div class="line">     <span class="comment">//ç”Ÿæˆbitæ•°ç»„ï¼Œç»‘å®šhashç­–ç•¥ï¼ˆé»˜è®¤ä¸ºMURMUR128_MITZ_64ï¼‰</span></div><div class="line">     <span class="keyword">return</span> <span class="keyword">new</span> BloomFilter&lt;T&gt;(<span class="keyword">new</span> BitArray(numBits), numHashFunctions, funnel, strategy);</div><div class="line">   &#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;</div><div class="line">     <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Could not create BloomFilter of "</span> + numBits + <span class="string">" bits"</span>, e);</div><div class="line">   &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<h3 id="æ„å»º"><a href="#æ„å»º" class="headerlink" title="æ„å»º"></a>æ„å»º</h3><p>è°ƒç”¨BloomFilterå®ä¾‹çš„putæ–¹æ³•æ¥æ·»åŠ å…ƒç´ ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function"><span class="keyword">boolean</span> <span class="title">put</span><span class="params">(</span></span></div><div class="line">    T object, Funnel&lt;? <span class="keyword">super</span> T&gt; funnel, <span class="keyword">int</span> numHashFunctions, BitArray bits) &#123;</div><div class="line">  <span class="keyword">long</span> bitSize = bits.bitSize();</div><div class="line">  <span class="keyword">byte</span>[] bytes = Hashing.murmur3_128().hashObject(object, funnel).getBytesInternal();</div><div class="line">  <span class="keyword">long</span> hash1 = lowerEight(bytes);</div><div class="line">  <span class="keyword">long</span> hash2 = upperEight(bytes);</div><div class="line"></div><div class="line">  <span class="keyword">boolean</span> bitsChanged = <span class="keyword">false</span>;</div><div class="line">  <span class="keyword">long</span> combinedHash = hash1;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numHashFunctions; i++) &#123;</div><div class="line">    <span class="comment">// Make the combined hash positive and indexable</span></div><div class="line">    <span class="comment">//è¿™é‡Œå…ˆå’ŒLongæœ€å¤§å€¼ä¸å»æ‰ç¬¦å·ä½ï¼Œæ¨¡bitæ•°ç»„é•¿åº¦æ¥å®šä½ï¼Œç„¶åå°è¯•å°†è¿™ä½ç½®1ã€‚æœ€ååŠ ä¸ŠHashing.murmur3_128()ç»“æœçš„é«˜8ä½åå¾ªç¯æ‰§è¡Œåˆšæ‰è¿‡ç¨‹ã€‚</span></div><div class="line">    bitsChanged |= bits.set((combinedHash &amp; Long.MAX_VALUE) % bitSize);</div><div class="line">    combinedHash += hash2;</div><div class="line">  &#125;</div><div class="line">  <span class="comment">//åˆ¤æ–­bitæ•°ç»„æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ï¼Œåœ¨ä¸Šè¾¹å¾ªç¯ä¸­æœ‰ä¸€ä½è¢«ç½®ä¸º1åˆ™è¯´æ˜æœ‰å˜åŒ–ï¼Œæ·»åŠ å…ƒç´ æˆåŠŸï¼Œè¿”å›trueï¼›å¦åˆ™å¯èƒ½ä¹‹å‰å·²ç»æ·»åŠ è¿‡ï¼Œæˆ–è€…å’Œåˆ«çš„å…ƒç´ hashç»“æœå†²çªï¼Œè¿”å›false;</span></div><div class="line">  <span class="keyword">return</span> bitsChanged;</div><div class="line">&#125;</div><div class="line"></div></pre></td></tr></table></figure>
<p>å¯è§Guavaä¸­BloomFilterçš„å®ç°å¹¶ä¸æ˜¯çœŸæ­£ç”¨äº†å¤šç§hashå‡½æ•°ï¼Œè€Œæ˜¯é€šè¿‡åŠ æ³•å’Œå–æ¨¡å®ç°å†hashã€‚</p>
<h3 id="åˆ¤æ–­"><a href="#åˆ¤æ–­" class="headerlink" title="åˆ¤æ–­"></a>åˆ¤æ–­</h3><p>åˆ¤æ–­è¿‡ç¨‹å’Œæ·»åŠ è¿‡ç¨‹ç±»ä¼¼ï¼Œå½“æœ‰ä¸€ä¸ªåº”è¯¥ä¸º1çš„ä½ä¸º0ï¼Œåˆ™è¿™ä¸ªå…ƒç´ è‚¯å®šä¸åœ¨é›†åˆä¸­ï¼Œç›´æ¥è¿”å›falseã€‚å› ä¸ºæœ‰ä¸€å®šè¯¯åˆ¤ç‡pï¼Œæ‰€ä»¥å‡½æ•°åä¸ºmightContainï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function"><span class="keyword">boolean</span> <span class="title">mightContain</span><span class="params">(</span></span></div><div class="line">        T object, Funnel&lt;? <span class="keyword">super</span> T&gt; funnel, <span class="keyword">int</span> numHashFunctions, BitArray bits) &#123;</div><div class="line">      <span class="keyword">long</span> bitSize = bits.bitSize();</div><div class="line">      <span class="keyword">byte</span>[] bytes = Hashing.murmur3_128().hashObject(object, funnel).getBytesInternal();</div><div class="line">      <span class="keyword">long</span> hash1 = lowerEight(bytes);</div><div class="line">      <span class="keyword">long</span> hash2 = upperEight(bytes);</div><div class="line"></div><div class="line">      <span class="keyword">long</span> combinedHash = hash1;</div><div class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numHashFunctions; i++) &#123;</div><div class="line">        <span class="comment">// Make the combined hash positive and indexable</span></div><div class="line">        <span class="keyword">if</span> (!bits.get((combinedHash &amp; Long.MAX_VALUE) % bitSize)) &#123;</div><div class="line">          <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        combinedHash += hash2;</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line"></div></pre></td></tr></table></figure></p>
<h2 id="åœ¨å·¥ç¨‹ä¸­çš„åº”ç”¨"><a href="#åœ¨å·¥ç¨‹ä¸­çš„åº”ç”¨" class="headerlink" title="åœ¨å·¥ç¨‹ä¸­çš„åº”ç”¨"></a>åœ¨å·¥ç¨‹ä¸­çš„åº”ç”¨</h2><h3 id="å»é‡"><a href="#å»é‡" class="headerlink" title="å»é‡"></a>å»é‡</h3><p>BloomFilterå¸¸ç”¨åœ¨çˆ¬è™«ç³»ç»Ÿä¸­çš„urlå»é‡ï¼Œå¯ä»¥èŠ‚çœå¤§é‡å†…å­˜ç©ºé—´ã€‚</p>
<h3 id="æ€§èƒ½ä¼˜åŒ–"><a href="#æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–"></a>æ€§èƒ½ä¼˜åŒ–</h3><p>BloomFilterå¯ä»¥æŒ¡åœ¨ç³»ç»Ÿçš„æœ€å‰è¾¹ï¼Œè¿›è¡Œæµé‡æœ‰æ•ˆæ€§çš„åˆ¤æ–­å’Œè¿‡æ»¤ã€‚å¦‚æœåˆ¤æ–­ä¸æ˜¯æ­¤ç³»ç»Ÿçš„ä¸šåŠ¡åˆ™ç›´æ¥ä¸¢å¼ƒï¼Œå‡è½»æœåŠ¡å‹åŠ›ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæµé‡ç»è¿‡çš„ç»„ä»¶çš„é¡ºåºæ˜¯è¿™æ ·çš„:BloomFilter-&gt;æœ¬åœ°ç¼“å­˜-&gt;è¿œç«¯ç¼“å­˜-&gt;dbï¼Œä¸­é—´æ¯ä¸ªç¯èŠ‚éƒ½å¯ä»¥å‘½ä¸­å¹¶è¿”å›ï¼Œå‡è½»å¯¹åè¾¹çš„å‹åŠ›ã€‚</p>
<h3 id="å…³é”®è¯è¿‡æ»¤"><a href="#å…³é”®è¯è¿‡æ»¤" class="headerlink" title="å…³é”®è¯è¿‡æ»¤"></a>å…³é”®è¯è¿‡æ»¤</h3><p>BloomFilterå¯ä»¥æ”¯æŒkeyword filterã€‚è‹±æ–‡æ–‡ç« æœ‰è‡ªç„¶çš„ç©ºæ ¼å­—ç¬¦åˆ†è¯ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å°†æ•æ„Ÿè¯åº“å»ºç«‹BloomFilterï¼Œå¯¹æ–‡ç« è¿›è¡Œè¿‡æ»¤ã€‚ä½†æ˜¯ä¸­æ–‡å°±æœ‰ç‚¹å°´å°¬äº†ï¼Œåªèƒ½ä½¿ç”¨å¤šæ¨¡å¼åŒ¹é…(ACè‡ªåŠ¨æœºã€ Wu-Manberç­‰)çš„ç²¾ç¡®ç®—æ³•æ¥è¿›è¡Œè¿‡æ»¤äº†ã€‚</p>
<h3 id="åˆ†å¸ƒå¼ç³»ç»Ÿ"><a href="#åˆ†å¸ƒå¼ç³»ç»Ÿ" class="headerlink" title="åˆ†å¸ƒå¼ç³»ç»Ÿ"></a>åˆ†å¸ƒå¼ç³»ç»Ÿ</h3><p>å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´ï¼Œæ¯å°æœºå™¨ä¸Šéƒ½ä¼šæœ‰è‡ªå·±çš„BloomFilterã€‚æ¯ä¸ªBloomFilteréƒ½æœ‰è‡ªå·±çš„ç‰ˆæœ¬å·ï¼Œå®ƒä»¬éœ€è¦å®šæ—¶å»ä¸€ä¸ªç»Ÿä¸€çš„æ•°æ®æº(dbæˆ–è€…æ–‡ä»¶)ä¸­loadæ•°æ®ï¼Œå¹¶æ‹¿è¿œç«¯çš„ç‰ˆæœ¬å·å’Œè‡ªå·±æœ¬åœ°ç‰ˆæœ¬å·è¿›è¡Œå¯¹æ¯”:å¦‚æœç›¸åŒåˆ™ç›´æ¥è·³è¿‡ï¼Œå¦‚æœä¸åŒåˆ™éœ€è¦æ‹¿è¿œç«¯æ•°æ®è¿›è¡Œå¢é‡æ„å»ºï¼›åŒæ—¶è¿˜éœ€è¦å®šæ—¶åœ¨ç³»ç»Ÿè´Ÿè½½ä½æ—¶è¿›è¡Œå…¨é‡æ„å»ºï¼Œä¿éšœæ‰€æœ‰æœºå™¨ä¸ŠBloomFilterçš„æœ‰æ•ˆæ€§å’Œæ­£ç¡®æ€§ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;BloomFilterç®€ä»‹&quot;&gt;&lt;a href=&quot;#BloomFilterç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;BloomFilterç®€ä»‹&quot;&gt;&lt;/a&gt;BloomFilterç®€ä»‹&lt;/h2&gt;&lt;p&gt;BloomFilteræ˜¯ä¸€ä¸ªå¯ä»¥å¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­çš„ç»„ä»¶ï¼Œå®ƒçš„è®¾è®¡ä¹Ÿæ¯”è¾ƒå®¹æ˜“ç†è§£ï¼šæ„å»ºçš„æ—¶å€™ï¼Œä¸€ä¸ªå…ƒç´ ç»è¿‡å‡ ä¸ªhashå‡½æ•°hashåï¼Œå‘½ä¸­ä¸€ä¸ªbitæ•°ç»„çš„ä¸åŒçš„ä½ç‚¹ï¼Œå¹¶æŠŠä½ç‚¹ç½®ä¸º1ã€‚åœ¨åˆ¤æ–­çš„æ—¶å€™ï¼Œä¹Ÿè¦æ‰§è¡ŒåŒæ ·çš„hashå‡½æ•°ï¼Œåªè¦æœ‰ä¸€ä¸ªæ²¡æœ‰å‘½ä¸­åˆ™è¿™ä¸ªå…ƒç´ ä¸€å®šä¸å­˜åœ¨ï¼›å¦åˆ™æœ‰å¯èƒ½å­˜åœ¨ã€‚åªä¼šæœ‰ä¸€ç§â€œè¯¯åˆ¤â€çš„æƒ…å†µï¼šå…ƒç´ ä¸åœ¨é›†åˆä¸­ï¼Œä½†è¢«åˆ¤æ–­ä¸ºåœ¨é›†åˆä¸­ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºæ„å»ºæ—¶å€™å¤šä¸ªå…ƒç´ ç»è¿‡hashå¯èƒ½å‘½ä¸­åŒæ ·çš„ä½ç‚¹ï¼Œè¿™æ ·ä¼šå½±å“åˆ¤æ–­æ—¶å€™çš„å‡†ç¡®ç‡ã€‚å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œbitæ•°ç»„è¶Šå¤§ï¼Œhashå‡½æ•°æ•£åˆ—æ•ˆæœè¶Šå¥½ï¼Œè¿™æ ·â€œå†²çªâ€çš„æ¦‚ç‡è¶Šå°ï¼Œåˆ¤æ–­çš„æ­£ç¡®ç‡è¶Šé«˜ã€‚ä½†æ˜¯ï¼Œæ‰©å¤§bitæ•°ç»„ä¼šå ç”¨æ›´å¤šå†…å­˜ï¼Œhashå‡½æ•°è®¡ç®—å¤æ‚åº¦å’Œæ•°é‡ä¼šå½±å“è®¡ç®—é€Ÿåº¦ã€‚æ‰€ä»¥å¦‚ä½•å¹³è¡¡æ­£ç¡®ç‡ä¸bitæ•°ç»„é•¿åº¦ã€hashå‡½æ•°çš„ä¸ªæ•°å‘¢ï¼Ÿæœ‰ä¸€ä¸ªå…¬å¼ï¼š&lt;/p&gt;
&lt;p&gt;å‡è®¾mæ˜¯bitæ•°ç»„çš„bitçš„æ•°é‡(é•¿åº¦)ï¼Œkæ˜¯hashå‡½æ•°çš„æ•°é‡ï¼Œnæ˜¯åœ¨æ„é€ æ—¶å…ƒç´ çš„æ•°é‡,pä¸ºåˆ¤æ–­æ—¶çš„é”™è¯¯ç‡ã€‚åˆ™å½“å®ƒä»¬æ»¡è¶³ä¸‹è¾¹ä¸¤ä¸ªå…¬å¼æ—¶ï¼Œæœ‰è¿‘ä¼¼æœ€ä¼˜è§£ã€‚&lt;/p&gt;
&lt;blockquote&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;m = -n * lnp / (ln2)^2 &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;k = m / n * ln2 &lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;p&gt;å…·ä½“çš„æ¨å¯¼è¿‡ç¨‹å¯ä»¥çœ‹ä¸‹&lt;a href=&quot;https://en.wikipedia.org/wiki/Bloom_filter#Probability_of_false_positives&quot;&gt;è¿™é‡Œã€‚&lt;/a&gt;&lt;br&gt;
    
    </summary>
    
      <category term="åå°" scheme="https://majiaji.github.io/categories/%E5%90%8E%E5%8F%B0/"/>
    
    
      <category term="Guava" scheme="https://majiaji.github.io/tags/Guava/"/>
    
      <category term="åå°" scheme="https://majiaji.github.io/tags/%E5%90%8E%E5%8F%B0/"/>
    
  </entry>
  
  <entry>
    <title>httpClientå‚æ•°è®¾ç½®</title>
    <link href="https://majiaji.github.io/2016/12/03/httpClient%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE/"/>
    <id>https://majiaji.github.io/2016/12/03/httpClientå‚æ•°è®¾ç½®/</id>
    <published>2016-12-02T17:27:28.000Z</published>
    <updated>2016-12-04T06:25:45.000Z</updated>
    
    <content type="html"><![CDATA[<p>httpClientæ˜¯ä¸€ä¸ªä¸è€ƒè™‘å‘ä¸‹å…¼å®¹çš„åº“ï¼Œä»3.xåˆ°4.x,å‡ ä¹æ¯ä¸ªç‰ˆæœ¬éƒ½æœ‰è¾ƒå¤§å·®å¼‚ã€‚æœ¬æ–‡ä½¿ç”¨çš„æ˜¯4.5.2ã€‚</p>
<p>httpClientæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„åº“ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨å®ƒï¼Œæˆ–è€…ä»¥å®ƒä¸ºåº•å±‚çš„ç½‘ç»œåº“æ¥å‘æœåŠ¡ç«¯å‘httpè¯·æ±‚ã€‚é€šå¸¸ä¸ºäº†ç®€å•ï¼Œæ¯æ¬¡éœ€è¦è¯·æ±‚çš„æ—¶å€™éƒ½ä¼šnewä¸€ä¸ªHttpClientå®ä¾‹å‡ºæ¥ï¼Œæ‹¿åˆ°ç»“æœåå†closeæ‰è¿™ä¸ªå®ä¾‹ã€‚</p>
<p>ä½†æ˜¯å¯¹äºæœåŠ¡ç«¯æ¥è¯´ï¼Œåœ¨é«˜å¹¶å‘çš„æ—¶å€™ï¼Œæ¯æ¬¡newå®ä¾‹å‡ºæ¥ï¼Œåœ¨æ€§èƒ½ä¸Šæ˜¯ä¸å¯æ¥å—çš„ã€‚æ‰€ä»¥è€ƒè™‘æ‰€æœ‰çš„è¯·æ±‚åªç”¨ä¸€ä¸ªhttpClientå®ä¾‹æ¥æå®šï¼Œè¿™æ—¶å€™å°±éœ€è¦å¥½å¥½checkä¸‹è¿™ä¸ªhttpClientçš„å‚æ•°ã€‚</p>
<a id="more"></a>
<h2 id="å‚æ•°è®¾ç½®"><a href="#å‚æ•°è®¾ç½®" class="headerlink" title="å‚æ•°è®¾ç½®"></a>å‚æ•°è®¾ç½®</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">private</span> HttpClient httpClient;</div><div class="line"></div><div class="line">   <span class="meta">@PostConstruct</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">//è¿æ¥æ± é…ç½®</span></div><div class="line">        PoolingHttpClientConnectionManager connectionManager = <span class="keyword">new</span> PoolingHttpClientConnectionManager();</div><div class="line">        <span class="comment">//æœ€å¤§å¹¶å‘è¿æ¥æ•°</span></div><div class="line">        connectionManager.setMaxTotal(<span class="number">500</span>);</div><div class="line">        <span class="comment">//æ¯ä¸ªurlæ”¯æŒçš„å¹¶å‘è¿æ¥æ•°</span></div><div class="line">        connectionManager.setDefaultMaxPerRoute(<span class="number">200</span>);</div><div class="line">        <span class="comment">//è¶…æ—¶é…ç½®</span></div><div class="line">        RequestConfig requestConfig = RequestConfig.custom()</div><div class="line">                <span class="comment">//ä»è¿æ¥æ± ä¸­å–è¿æ¥</span></div><div class="line">                .setConnectionRequestTimeout(<span class="number">1000</span>)</div><div class="line">                <span class="comment">//è¿›è¡Œè¿æ¥</span></div><div class="line">                .setConnectTimeout(<span class="number">5000</span>)</div><div class="line">                <span class="comment">//socketè¯»</span></div><div class="line">                .setSocketTimeout(<span class="number">5000</span>).build();</div><div class="line">        httpClient = HttpClients.custom()</div><div class="line">                .setDefaultRequestConfig(requestConfig)</div><div class="line">                .setConnectionManager(connectionManager)</div><div class="line">                .build();</div><div class="line">    &#125;</div><div class="line"></div></pre></td></tr></table></figure>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒPer default this implementation will create no more than than 2 concurrent connections per given route and no more 20 connections in totalã€‚æ‰€ä»¥éœ€è¦è®¾ç½®ä¸‹æ€»çš„è¿æ¥æ•°å’Œæ¯ä¸ªrouteæ”¯æŒçš„è¿æ¥æ•°ï¼Œå¦åˆ™å½“å¹¶å‘é‡å¤§æ—¶ï¼Œä»è¿æ¥æ± ä¸­å–è¿æ¥æ—¶ä¼šå–ä¸åˆ°ï¼Œå¯¼è‡´è¯·æ±‚å¤±è´¥ã€‚</p>
<p>ä½¿ç”¨httpClientæœ€æ€•å‘ç”Ÿé˜»å¡ä¸”æ²¡æœ‰è¶…æ—¶è¿”å›çš„æƒ…å†µï¼Œæ‰€ä»¥éœ€è¦æ ¹æ®è‡ªå·±çš„éœ€æ±‚é…ç½®ä¸‰ä¸ªè¶…æ—¶æ—¶é—´ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;httpClientæ˜¯ä¸€ä¸ªä¸è€ƒè™‘å‘ä¸‹å…¼å®¹çš„åº“ï¼Œä»3.xåˆ°4.x,å‡ ä¹æ¯ä¸ªç‰ˆæœ¬éƒ½æœ‰è¾ƒå¤§å·®å¼‚ã€‚æœ¬æ–‡ä½¿ç”¨çš„æ˜¯4.5.2ã€‚&lt;/p&gt;
&lt;p&gt;httpClientæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„åº“ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨å®ƒï¼Œæˆ–è€…ä»¥å®ƒä¸ºåº•å±‚çš„ç½‘ç»œåº“æ¥å‘æœåŠ¡ç«¯å‘httpè¯·æ±‚ã€‚é€šå¸¸ä¸ºäº†ç®€å•ï¼Œæ¯æ¬¡éœ€è¦è¯·æ±‚çš„æ—¶å€™éƒ½ä¼šnewä¸€ä¸ªHttpClientå®ä¾‹å‡ºæ¥ï¼Œæ‹¿åˆ°ç»“æœåå†closeæ‰è¿™ä¸ªå®ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯å¯¹äºæœåŠ¡ç«¯æ¥è¯´ï¼Œåœ¨é«˜å¹¶å‘çš„æ—¶å€™ï¼Œæ¯æ¬¡newå®ä¾‹å‡ºæ¥ï¼Œåœ¨æ€§èƒ½ä¸Šæ˜¯ä¸å¯æ¥å—çš„ã€‚æ‰€ä»¥è€ƒè™‘æ‰€æœ‰çš„è¯·æ±‚åªç”¨ä¸€ä¸ªhttpClientå®ä¾‹æ¥æå®šï¼Œè¿™æ—¶å€™å°±éœ€è¦å¥½å¥½checkä¸‹è¿™ä¸ªhttpClientçš„å‚æ•°ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="åå°" scheme="https://majiaji.github.io/categories/%E5%90%8E%E5%8F%B0/"/>
    
    
      <category term="åå°" scheme="https://majiaji.github.io/tags/%E5%90%8E%E5%8F%B0/"/>
    
      <category term="httpClient" scheme="https://majiaji.github.io/tags/httpClient/"/>
    
  </entry>
  
  <entry>
    <title>å‰ç«¯å¼€å‘çš„æµ®å…‰æ å½±</title>
    <link href="https://majiaji.github.io/2016/11/23/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E7%9A%84%E6%B5%AE%E5%85%89%E6%8E%A0%E5%BD%B1/"/>
    <id>https://majiaji.github.io/2016/11/23/å‰ç«¯å¼€å‘çš„æµ®å…‰æ å½±/</id>
    <published>2016-11-22T16:04:18.000Z</published>
    <updated>2016-11-26T11:32:45.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å‰æ®µæ—¶é—´æœ‰ä¸ªæ¯”è¾ƒğŸ”¥çš„æ–‡ç«  <a href="https://zhuanlan.zhihu.com/p/22782487" target="_blank" rel="external">åœ¨2016å¹´å­¦JavaScriptæ˜¯ä¸€ç§ä»€ä¹ˆæ ·çš„ä½“éªŒ</a> è¯»å®Œä¹‹åæ·±æ·±æ„Ÿå—åˆ°äº†å‰ç«¯åŒå­¦çš„ç—›ç‚¹ï¼šç”¨å¥½å„ç§æ¡†æ¶ã€è„šæ‰‹æ¶å·²ç»è®©äººåº”æ¥ä¸æš‡äº†ï¼Œä¸æ­¤åŒæ—¶è¿˜è¦ä¸åœåœ°é€ è‡ªå·±çš„å°è½®å­ï¼Œç€å®ä¸æ˜“ã€‚</p>
<p>åœ¨å¤§å­¦çš„æœ‰æ®µæ—¶é—´ï¼Œæˆ‘ä¹Ÿè€ƒè™‘è¿‡å»åšå‰ç«¯ã€‚å› ä¸ºæ‰€è§å³æ‰€å¾—çš„ä¸œè¥¿è¿˜æ˜¯å¾ˆå®¹æ˜“ç»™äººæˆå°±æ„Ÿçš„ã€‚åæ¥åªåšæŒå­¦äº†åŠä¸ªå­¦æœŸå°±æ”¾å¼ƒäº†ï¼Œä¸»è¦å› ä¸ºä¸€ç›´æ²¡æœ‰ææ‡‚ï¼Œä¹Ÿè®°ä¸ä½å„ç§cssæ ‡ç­¾çš„å«ä¹‰ï¼Œè¿™æ ·å¯¼è‡´æ¯æ¬¡åœ¨è°ƒæ ·å¼çš„æ—¶å€™éƒ½æ— æ¯”æ‰æ€¥ï¼Œè¿æœ€åŸºç¡€çš„è¿˜åŸè§†è§‰ç¨¿éƒ½åšä¸åˆ°ã€‚äºæ˜¯åˆæ‚»æ‚»çš„å›åˆ°äº†é»‘æ¡†æ¡†çš„åç«¯ä¸–ç•Œã€‚</p>
<p>æ­£å¼å·¥ä½œåä¹Ÿæœ‰æœºä¼šæ¥è§¦ä¸€äº›å‰ç«¯çš„å·¥ä½œï¼Œåœ¨å·¥ä½œä¹‹ä½™æˆ‘æ€»ç»“äº†è‡ªå·±å¸¸ç”¨çš„å¼€å‘æ¨¡å¼å’Œå¥—è·¯ï¼Œåˆ†äº«ç»™å¤§å®¶ï¼š</p>
<a id="more"></a>
<h2 id="Velocity-jQuery-Bootstrap"><a href="#Velocity-jQuery-Bootstrap" class="headerlink" title="Velocity + jQuery + Bootstrap"></a>Velocity + jQuery + Bootstrap</h2><p>è¿™ä¸ªç”¨çš„æ˜¯æœ€å¤šçš„ã€‚Velocityç»“åˆspringMVCä¸€èµ·ä½¿ç”¨ï¼Œåœ¨Controllerå‰ï¼ŒæŠŠå¯¹è±¡å¡åˆ°ä¸€ä¸ªmodelMapä¸­ï¼Œç„¶åç”±VelocityEngineæ ¹æ®vmæ¨¡æ¿å»æ¸²æŸ“ï¼Œç„¶åå†è¿”å›ç»™æµè§ˆå™¨ã€‚ä¹‹åå‰ç«¯é¡µé¢çš„ä¸šåŠ¡é€»è¾‘é€šè¿‡ajaxè¯·æ±‚åç«¯æ¥å£ï¼Œç„¶åç”¨jQueryç›´æ¥æ“ä½œdomèŠ‚ç‚¹ä¿®æ”¹ï¼Œç®€å•ç²—æš´ã€‚</p>
<p>è¿™ä¸ªå¥—è·¯æ˜¯æ¯”è¾ƒç®€å•ä¹Ÿæ¯”è¾ƒå¸¸ç”¨çš„ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœä»0å¼€å§‹æ­å»ºä¸€ä¸ªç³»ç»Ÿçš„å‰ç«¯æ¡†æ¶é‚£ä¹ˆè¦æ€ä¹ˆåšæ‰å¥½å‘¢ï¼Ÿheaderå•Šsidebarå•Šå¸ƒå±€å•Šè¿˜æ˜¯ä¸çŸ¥é“å¦‚ä½•ä¸‹æ‰‹ã€‚è¿™æ—¶å€™å¯ä»¥ç”¨ä¸‹ <a href="http://www.bootcss.com/p/layoutit" target="_blank" rel="external">Bootstrapå¯è§†åŒ–å¸ƒå±€ç³»ç»Ÿ</a> å¯ä»¥ç”¨è¿™ä¸ªå·¥å…·ç›´æ¥æ‹–å‡ºæ¥æƒ³è¦çš„å‰ç«¯æ …æ ¼å¸ƒå±€ã€å¯¼èˆªæ ã€è¾¹æ äºŒçº§å¯¼èˆªï¼ˆå¦‚æœéœ€è¦)ã€footerç­‰ï¼Œä¸æ»¡æ„çš„ç»†èŠ‚å¯ä»¥æŠŠå®ƒdownä¸‹æ¥è‡ªå·±æ‰‹åŠ¨ä¿®æ”¹ä¸€ä¸‹ï¼Œéœ€è¦çš„ç»„ä»¶å¯ä»¥åˆ° <a href="http://www.bootcss.com/" target="_blank" rel="external">Bootstrapç»„ä»¶åº“</a>ä¸­æŸ¥æ‰¾ã€‚</p>
<p>Bootstrapåº“ä¸­çš„ç»„ä»¶è¿˜æ˜¯æ¯”è¾ƒé½å…¨çš„ï¼Œè€Œä¸”å› ä¸ºä½¿ç”¨çš„äººå¾ˆå¤šä¹Ÿæ¯”è¾ƒç¨³å®šï¼Œä¸ä¼šæœ‰ä»€ä¹ˆå¥‡æ€ªçš„bugã€‚å¦‚æœä¸ä»…ä»…æ»¡è¶³äºè¿™äº›åŸºç¡€çš„ç»„ä»¶ï¼Œè¿˜å¯ä»¥åˆ°<a href="http://www.jq22.com/" target="_blank" rel="external">jQueryæ’ä»¶åº“</a>ä¸­æŸ¥æ‰¾è‡ªå·±å–œæ¬¢çš„é…·ç‚«çš„jQueryç»„ä»¶ã€‚ä¸è¿‡è¿™æ—¶å€™éœ€è¦æ³¨æ„ç»„ä»¶åº“ä¹‹é—´æœ‰å¯èƒ½ä¼šå†²çªï¼Œå¼•ç”¨æ—¶å€™è¦checkä¸€ä¸‹ã€‚</p>
<p>æ€»ç»“ï¼š<br>ç”¨ä¸Šè¿°å·¥å…·å¯ä»¥å¿«é€Ÿä»é›¶æ­å»ºèµ·æ¥ä¸€ä¸ªå‰ç«¯ç³»ç»Ÿæ¡†æ¶ï¼Œå¹¶è¿›è¡Œä¸šåŠ¡å¼€å‘ã€‚éœ€è¦äº†è§£ä¸€ä¸‹Velocityå’ŒjQueryçš„è¯­æ³•ï¼Œå°¤å…¶è¦ç†Ÿç»ƒä½¿ç”¨jQueryé€‰æ‹©å™¨ã€‚<br>ä¼˜ç‚¹ï¼š<br>ç¬¦åˆç®€å•çš„â€œé¢å‘è¿‡ç¨‹â€çš„å¼€å‘æ€ç»´ï¼Œå®¹æ˜“ä¸Šæ‰‹ï¼Œå¯ä»¥å¿«é€Ÿå®ç°éœ€æ±‚ã€‚<br>ç¼ºç‚¹ï¼š<br>å½“éœ€è¦åŠ¨æ€æ“ä½œå¤§é‡çš„domèŠ‚ç‚¹æ—¶å€™ç®€ç›´å°±æ˜¯ç¾éš¾ï¼šå½“æœ‰ä¸šåŠ¡éœ€è¦ç”±ajaxè¿”å›çš„ç»“æœå†³å®šå±•ç¤ºä»€ä¹ˆå†…å®¹æ—¶ï¼Œå°±éœ€è¦ç”¨jQueryç›´æ¥æ“ä½œå¾ˆå¤šdomèŠ‚ç‚¹ã€‚è¿™æ—¶å€™å°±æ¯”è¾ƒè€ƒçœ¼åŠ›äº†ï¼Œéœ€è¦åœ¨å„ç§å°–æ‹¬å·çš„æ ‡ç­¾ä¹‹é—´çœ‹æ¸…æ¥šå­—ç¬¦ä¸²å¼•å·æ˜¯å•å¼•å·è¿˜æ˜¯åŒå¼•å·â€¦â€¦ è€Œä¸”å›¢é˜Ÿä¸­çš„åŒå­¦ä¹Ÿå¾ˆéš¾çœ‹æ˜ç™½è¿™ä¸€å¨domæ ‡ç­¾æ˜¯æƒ³å¹²å˜›ï¼Œéš¾ä»¥ç»´æŠ¤ã€‚</p>
<h2 id=""><a href="#" class="headerlink" title=""></a><a href="https://vuejs.org.cn/guide/" target="_blank" rel="external">Vue</a></h2><p>Vueæ˜¯åœ¨ä¸‹åˆåƒæ°´æœæ—¶å¬åˆ°åŒäº‹æèµ·çš„ï¼Œå›æ¥å­¦ä¹ äº†ä¸€ä¸‹åå‘ç°çœŸçš„æ˜¯ä¸ªå¥½ä¸œè¥¿ï¼šVueæ”¯æŒå“åº”å¼çš„æ•°æ®åŒå‘ç»‘å®šã€‚åœ¨ä½¿ç”¨jQueryæ‰‹å·¥æ“ä½œdomæ—¶ï¼Œæˆ‘ä»¬çš„ä»£ç å¸¸å¸¸æ˜¯å‘½ä»¤å¼çš„ã€é‡å¤çš„å’Œæ˜“é”™çš„ã€‚Vueæ‹¥æŠ±æ•°æ®é©±åŠ¨è§†å›¾çš„æ¦‚å¿µï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¦æ“ä½œçš„å¯¹è±¡å£°æ˜ä¸ºä¸€ä¸ªVueå¯¹è±¡ï¼ŒåŒæ—¶åœ¨domæ ‡ç­¾ä¸­ç”¨ç‰¹æ®Šçš„å ä½ç¬¦ï¼ˆåŒå¤§æ‹¬å·ï¼‰åœ¨å ä½ï¼Œè¿™æ ·å°±è¿›è¡Œäº†ç»‘å®šã€‚æ¯æ¬¡ä¿®æ”¹Vueå¯¹è±¡ï¼Œdomä¸­çš„å…ƒç´ ä¼šå“åº”å¼çš„æ›´æ–°ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥å®æ—¶çš„æ‹¿åˆ°Vueå¯¹è±¡ä¸­çš„å€¼å’ŒæœåŠ¡ç«¯è¿›è¡Œäº¤äº’ï¼Œå†ä¹Ÿä¸ç”¨ç†Ÿè®°å„ç§èŠ±å¼çš„jQueryé€‰æ‹©å™¨æŠ€å·§äº†ã€‚</p>
<p>æ€»ç»“ï¼š<br>Vueå¯¹äºç†Ÿç»ƒVelocityçš„åŒå­¦éå¸¸å®¹æ˜“ä¸Šæ‰‹ï¼Œå®ƒä»¬éƒ½æ˜¯ä½¿ç”¨äº†è‡ªå·±çš„æ ‡ç­¾è¿›è¡Œå ä½ã€‚Vueåªå…³æ³¨è§†å›¾å±‚ï¼Œå¯ä»¥éå¸¸å®¹æ˜“å’ŒjQueryã€Bootstrapç­‰å…¶ä»–æ¡†æ¶å…±åŒä½¿ç”¨ã€‚<br>ä¼˜ç‚¹ï¼š<br>åŒå‘ç»‘å®šï¼Œä¸å…¶ä»–æ¡†æ¶å‹å¥½å…¼å®¹ï¼Œä¸Šæ‰‹ç®€å•ã€‚<br>ç¼ºç‚¹ï¼šæš‚æ— ã€‚</p>
<h2 id="-1"><a href="#-1" class="headerlink" title=""></a><a href="https://facebook.github.io/react/" target="_blank" rel="external">React</a></h2><p>Reactæ˜¯ç°åœ¨æœ€ğŸ”¥çš„å‰ç«¯æ¡†æ¶ã€‚é¦–å…ˆè¦è½¬å˜ä¸‹æ€ç»´ï¼šå¿˜æ‰Velocityå’ŒVueçš„æ¨¡æ¿+å ä½ç¬¦çš„å¼€å‘æ–¹å¼ï¼Œä½¿ç”¨Reactæ—¶è¦æŠŠwebé¡µé¢ä¸­çš„æ¯ä¸€éƒ¨åˆ†æŠ½è±¡æˆä¸€ä¸ªâ€œç»„ä»¶â€ï¼Œæ¯ä¸ªç»„ä»¶éƒ½è¦æŠ½å‡ºæ¥ä¸€ä¸ªå‡½æ•°å•ç‹¬å®ç°æ¸²æŸ“é€»è¾‘ã€‚æœ€åå†æŠŠè¿™äº›æ¸²æŸ“é€»è¾‘åƒæ­ç§¯æœ¨ä¸€æ ·å †èµ·æ¥ï¼Œå†å»æ•´ä½“è¿›è¡Œrenderã€‚</p>
<p>Reactä¸­æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼šçŠ¶æ€ä¸­å¿ƒï¼Œåœ¨æˆ‘çœ‹æ¥å®ƒå°±åƒæ˜¯ä¸€ä¸ªå¯¹å¤–ç»Ÿä¸€çš„æ¥å£ï¼Œåœ¨æ¸²æŸ“å‡½æ•°ä¸­å¯ä»¥ç”¨this.stateå–åˆ°å„ä¸ªå±æ€§çš„å€¼ï¼Œå½“ä½¿ç”¨this.setStateä¿®æ”¹å±æ€§å€¼æ—¶ï¼Œä¼šè¿›è¡Œdom diffï¼Œç„¶åReactè‡ªåŠ¨è°ƒç”¨renderæ–¹æ³•ï¼Œå†æ¬¡æ¸²æŸ“æ‰€æœ‰ç»„ä»¶ã€‚</p>
<p>ä½¿ç”¨Reactéœ€è¦äº†è§£ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸçš„çŠ¶æ€å’Œå¯¹åº”çš„å¤„ç†å‡½æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">componentWillMount()</div><div class="line">componentDidMount()</div><div class="line">componentWillUpdate(object nextProps, object nextState)</div><div class="line">componentDidUpdate(object prevProps, object prevState)</div><div class="line">componentWillUnmount()</div></pre></td></tr></table></figure>
<p>å…¶ä¸­é€šè¿‡Ajaxè·å–æœåŠ¡ç«¯æ•°æ®ï¼Œè¿›è¡Œåˆå§‹åŒ–stateçš„æ–¹æ³•è¦æ”¾åœ¨componentDidMount()ä¸­æ‰§è¡Œã€‚è€ƒè™‘æ€§èƒ½ä¼˜åŒ–æ—¶éœ€è¦å®ç°å¦å¤–çš„çŠ¶æ€å¤„ç†å‡½æ•°shouldComponentUpdate()ã€‚æ­å»ºå¤æ‚çš„é¡µé¢éœ€è¦å­¦ä¹ reduxã€‚</p>
<p>ä½¿ç”¨Reactå¯èƒ½æ˜¯å› ä¸ºä¸šåŠ¡æ–¹è§‰å¾—å‚å†…çš„å¯¹Reactå°è£…çš„é‚£ä¸€å¥—ç»„ä»¶æ›´å¥½çœ‹ä¸€äº›ï¼Œè€Œä¸”å‚å†…çš„å‰ç«¯åŒå­¦ä¹Ÿåœ¨å¤§åŠ›æ¨å¹¿ä»–ä»¬çš„æ–°ç»„ä»¶åº“ï¼Œå¹¶ä¸”æä¾›æŠ€æœ¯æ”¯æŒã€‚ä½†æ˜¯å¯¹äºåç«¯åŒå­¦æ¥è¯´ï¼ŒReactä¼¼ä¹ä¸æ˜¯é‚£ä¹ˆâ€œå‹å¥½â€ï¼Œéœ€è¦å­¦ä¹ ç†è§£å’Œæ’å‘çš„æˆæœ¬ç•¥é«˜ã€‚é‡åˆ°é—®é¢˜æ—¶å¯æŸ¥è¯¢çš„èµ„æ–™ä¸å¤šã€‚Reactä¸èƒ½ç›´æ¥ç®€å•æ“ä½œdom(æœ‰éº»çƒ¦çš„åŠæ³•)ï¼Œå½“æƒ³æ“ä½œdomå®ç°ä¸€ä¸ªç®€å•é€»è¾‘æ—¶æ¯”è¾ƒå›°éš¾ã€‚</p>
<p>æ€»ç»“ï¼š<br>Reacté€‚åˆé‚£ç§domç±»å‹å’Œä½ç½®éƒ½ç¡®å®šçš„å¤æ‚é¡µé¢ï¼Œå®ƒæ”¯æŒæ•°æ®çš„å•å‘ç»‘å®šï¼Œå³ä¿®æ”¹stateä¸­çš„å±æ€§ï¼Œç„¶åè‡ªåŠ¨çš„è¿›è¡Œrenderã€‚å¯¹äºç®€å•çš„é¡µé¢æ¥è¯´ï¼Œè€ƒè™‘åˆ°ä¸Šæ‰‹éš¾åº¦ï¼Œæœ‰ç‚¹å¾—ä¸å¿å¤±ã€‚ä½†æ˜¯è¿™æ˜¯æœªæ¥çš„è¶‹åŠ¿å˜›ï¼Œå­¦ä¹ ä¸€ä¸‹è¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚<br>ä¼˜ç‚¹ï¼š<br>ç»„ä»¶åŒ–ã€å‡½æ•°å¼ã€ç¤¾åŒºæ´»è·ƒ<br>ç¼ºç‚¹ï¼š<br>å­¦ä¹ æˆæœ¬é«˜ï¼Œä¸Šæ‰‹éš¾åº¦å¤§ï¼Œæ’æŸ¥é—®é¢˜å›°éš¾</p>
<h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>æœ¬æ–‡æ²¡æœ‰è®¨è®ºå„ç§å‰ç«¯æ¡†æ¶åº•å±‚çš„å®ç°ï¼Œå¦‚Vueçš„åº•å±‚å®ç°å’ŒReactçš„Virtual DOMå“ªä¸ªæ€§èƒ½æ›´å¥½ï¼Œä»…ä»…æ˜¯ç«™åœ¨ä¸€ä¸ªçº¯åˆçº§ä½¿ç”¨è€…çš„è§’åº¦å»è°ˆè°ˆè‡ªå·±åœ¨ä½¿ç”¨è¿™äº›æ¡†æ¶æ—¶çš„æ„Ÿå—å’Œç†è§£ã€‚æ‰€ä»¥åªèƒ½ç®—æ˜¯æµ®å…‰æ å½±äº†ã€‚<br>å¦‚æœ‰ç†è§£é”™è¯¯çš„åœ°æ–¹ï¼Œæ¬¢è¿è®¨è®ºäº¤æµã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;å‰æ®µæ—¶é—´æœ‰ä¸ªæ¯”è¾ƒğŸ”¥çš„æ–‡ç«  &lt;a href=&quot;https://zhuanlan.zhihu.com/p/22782487&quot;&gt;åœ¨2016å¹´å­¦JavaScriptæ˜¯ä¸€ç§ä»€ä¹ˆæ ·çš„ä½“éªŒ&lt;/a&gt; è¯»å®Œä¹‹åæ·±æ·±æ„Ÿå—åˆ°äº†å‰ç«¯åŒå­¦çš„ç—›ç‚¹ï¼šç”¨å¥½å„ç§æ¡†æ¶ã€è„šæ‰‹æ¶å·²ç»è®©äººåº”æ¥ä¸æš‡äº†ï¼Œä¸æ­¤åŒæ—¶è¿˜è¦ä¸åœåœ°é€ è‡ªå·±çš„å°è½®å­ï¼Œç€å®ä¸æ˜“ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å¤§å­¦çš„æœ‰æ®µæ—¶é—´ï¼Œæˆ‘ä¹Ÿè€ƒè™‘è¿‡å»åšå‰ç«¯ã€‚å› ä¸ºæ‰€è§å³æ‰€å¾—çš„ä¸œè¥¿è¿˜æ˜¯å¾ˆå®¹æ˜“ç»™äººæˆå°±æ„Ÿçš„ã€‚åæ¥åªåšæŒå­¦äº†åŠä¸ªå­¦æœŸå°±æ”¾å¼ƒäº†ï¼Œä¸»è¦å› ä¸ºä¸€ç›´æ²¡æœ‰ææ‡‚ï¼Œä¹Ÿè®°ä¸ä½å„ç§cssæ ‡ç­¾çš„å«ä¹‰ï¼Œè¿™æ ·å¯¼è‡´æ¯æ¬¡åœ¨è°ƒæ ·å¼çš„æ—¶å€™éƒ½æ— æ¯”æ‰æ€¥ï¼Œè¿æœ€åŸºç¡€çš„è¿˜åŸè§†è§‰ç¨¿éƒ½åšä¸åˆ°ã€‚äºæ˜¯åˆæ‚»æ‚»çš„å›åˆ°äº†é»‘æ¡†æ¡†çš„åç«¯ä¸–ç•Œã€‚&lt;/p&gt;
&lt;p&gt;æ­£å¼å·¥ä½œåä¹Ÿæœ‰æœºä¼šæ¥è§¦ä¸€äº›å‰ç«¯çš„å·¥ä½œï¼Œåœ¨å·¥ä½œä¹‹ä½™æˆ‘æ€»ç»“äº†è‡ªå·±å¸¸ç”¨çš„å¼€å‘æ¨¡å¼å’Œå¥—è·¯ï¼Œåˆ†äº«ç»™å¤§å®¶ï¼š&lt;/p&gt;
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://majiaji.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="å‰ç«¯" scheme="https://majiaji.github.io/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="javascript" scheme="https://majiaji.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>å•Šï¼Œç¬¬ä¸€ç¯‡åšå®¢</title>
    <link href="https://majiaji.github.io/2016/11/21/%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2/"/>
    <id>https://majiaji.github.io/2016/11/21/ç¬¬ä¸€ç¯‡åšå®¢/</id>
    <published>2016-11-21T07:06:25.000Z</published>
    <updated>2016-11-21T16:29:10.000Z</updated>
    
    <content type="html"><![CDATA[<h2>ä¸ºä»€ä¹ˆè¦å†™åšå®¢</h2>

<p>ç°åœ¨æŠ€æœ¯è¶Šæ¥è¶Šå¥½äº†ï¼Œç½‘ç»œå†…å®¹çš„ä¸»æµåª’ä»‹å®Œæˆäº†æ–‡å­—-&gt;å›¾ç‰‡-&gt;è§†é¢‘-&gt;ç›´æ’­è¿™æ ·çš„è½¬å˜ã€‚ä¸‹ç­å›æ¥åï¼Œç»å¸¸å„ç§app(å¾®ä¿¡çŸ¥ä¹å¤´æ¡å¾®åšç­‰)åˆ·ä¸€éï¼Œæ¥è¡¥å……ä¸€ä¸‹ç™½å¤©è¢«æŠ½ç©ºçš„ç²¾ç¥ä¸–ç•Œã€‚åæ¥æˆ‘å‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå¯¹äºå„ç§ç½‘ç»œå†…å®¹æ¥è¯´ï¼Œæˆ‘ä¸€ç›´éƒ½æ˜¯ä¸€ä¸ªâ€œçœ‹å®¢â€ï¼Œå‡ ä¹å¾ˆå°‘å»è¯„è®ºæˆ–è€…ä¸»åŠ¨æå‡ºä¸€äº›è§‚ç‚¹ï¼Œè¿™æ˜¯ä¸€ä»¶éå¸¸å¯æ€•çš„äº‹æƒ…ã€‚è™½ç„¶çœ‹åˆ«äººçš„ä¸œè¥¿ä¹Ÿèƒ½å­¦åˆ°å¾ˆå¤šä¸œè¥¿ï¼Œä½†æ˜¯å°‘äº†ä¸€ä¸ªè‡ªå·±ä¸»åŠ¨æ€è€ƒçš„è¿‡ç¨‹ã€‚æœ€è¿‘ä¹Ÿåœ¨è¿½<a href="http://www.hbo.com/westworld" target="_blank" rel="external">è¥¿éƒ¨ä¸–ç•Œ</a>ï¼Œè¿™ç®—ä¸ç®—ä¸€ç§è‡ªæˆ‘è§‰é†’å‘¢ï¼Ÿå“ˆå“ˆã€‚<br>æ‰€ä»¥æ‰“ç®—ä»ä»Šå¤©å¼€å§‹å†™åšå®¢äº†ï¼Œå¯èƒ½åŒ…æ‹¬è‡ªå·±æ—¥å¸¸ç”Ÿæ´»ä¸­çš„æ„Ÿæ‚Ÿã€åæ§½å’Œç†è§£ï¼Œè¿˜ä¼šåˆ†äº«ä¸€äº›æŠ€æœ¯çŸ¥è¯†å’Œè¸©è¿‡çš„å‘ï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆ°å¤§å®¶ï¼Œä¹Ÿå¸Œæœ›èƒ½è®¤è¯†æ›´å¤šçš„æœ‹å‹ã€‚</p>
<p></p><h2>flag</h2><br>è¿™é‡Œå…ˆç«‹ä¸ªflagï¼Œæ¯å‘¨è‡³å°‘ä¸€ç¯‡è¯¦ç»†çš„æŠ€æœ¯åšå®¢ï¼ŒåšæŒï¼Œå…±å‹‰ã€‚<p></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2&gt;ä¸ºä»€ä¹ˆè¦å†™åšå®¢&lt;/h2&gt;

&lt;p&gt;ç°åœ¨æŠ€æœ¯è¶Šæ¥è¶Šå¥½äº†ï¼Œç½‘ç»œå†…å®¹çš„ä¸»æµåª’ä»‹å®Œæˆäº†æ–‡å­—-&amp;gt;å›¾ç‰‡-&amp;gt;è§†é¢‘-&amp;gt;ç›´æ’­è¿™æ ·çš„è½¬å˜ã€‚ä¸‹ç­å›æ¥åï¼Œç»å¸¸å„ç§app(å¾®ä¿¡çŸ¥ä¹å¤´æ¡å¾®åšç­‰)åˆ·ä¸€éï¼Œæ¥è¡¥å……ä¸€ä¸‹ç™½å¤©è¢«æŠ½ç©ºçš„ç²¾ç¥ä¸–ç•Œã€‚åæ¥æˆ‘å‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå¯¹äºå„ç§ç½‘ç»œå†…å®¹æ¥è¯´ï¼Œæˆ‘ä¸€
    
    </summary>
    
      <category term="é—²è°ˆ" scheme="https://majiaji.github.io/categories/%E9%97%B2%E8%B0%88/"/>
    
    
      <category term="é—²è°ˆ" scheme="https://majiaji.github.io/tags/%E9%97%B2%E8%B0%88/"/>
    
  </entry>
  
</feed>
